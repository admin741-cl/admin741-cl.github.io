<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>canvas学习 | 孔乙己的长衫</title><meta name="author" content="admin741,1957875100@qq.com"><meta name="copyright" content="admin741"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="01-认识canvas身为一个WEB开发人员，肯定都是想着能够开发出酷炫和激动人心的应用程序来。可以很多动画特效，例如黑客帝国的数字，彩色炫酷的例子动效。也可以实现各种图画面板，如实现类似于photoshop的web在线图像编辑。各种酷炫的表单等等。  案例 画布是H5中一个重要的概念，它面向开发人员提供了非常底层的绘图接口，使得绘制速度可以大幅提高，这对游戏等领域极为重要。  本次课程中将非常系">
<meta property="og:type" content="article">
<meta property="og:title" content="canvas学习">
<meta property="og:url" content="https://admin741-cl.github.io/posts/cdc4.html">
<meta property="og:site_name" content="孔乙己的长衫">
<meta property="og:description" content="01-认识canvas身为一个WEB开发人员，肯定都是想着能够开发出酷炫和激动人心的应用程序来。可以很多动画特效，例如黑客帝国的数字，彩色炫酷的例子动效。也可以实现各种图画面板，如实现类似于photoshop的web在线图像编辑。各种酷炫的表单等等。  案例 画布是H5中一个重要的概念，它面向开发人员提供了非常底层的绘图接口，使得绘制速度可以大幅提高，这对游戏等领域极为重要。  本次课程中将非常系">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://w.wallhaven.cc/full/85/wallhaven-85dgxj.png">
<meta property="article:published_time" content="2023-01-08T10:59:41.000Z">
<meta property="article:modified_time" content="2023-06-17T02:32:00.666Z">
<meta property="article:author" content="admin741">
<meta property="article:tag" content="笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://w.wallhaven.cc/full/85/wallhaven-85dgxj.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://admin741-cl.github.io/posts/cdc4.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/manifest.json"/><meta name="msapplication-TileColor" content="#3b70fc"/><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/128.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"/><link rel="mask-icon" href="/img/siteicon/128.png" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'canvas学习',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-06-17 10:32:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-categories-card@1.0.0/lib/categorybar.css"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/css/runtime/runtime.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="孔乙己的长衫" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><script>window.paceOptions = {
  restartOnPushState: false
}

document.addEventListener('pjax:send', () => {
  Pace.restart()
})
</script><link rel="stylesheet" href="/css/progress_bar.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/404.jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/index.html"><i class="fa-fw fas fa-home"></i><span> 追番</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://w.wallhaven.cc/full/9d/wallhaven-9d8ee1.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="孔乙己的长衫"><span class="site-name">孔乙己的长衫</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/index.html"><i class="fa-fw fas fa-home"></i><span> 追番</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">canvas学习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-01-08T10:59:41.000Z" title="发表于 2023-01-08 18:59:41">2023-01-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-06-17T02:32:00.666Z" title="更新于 2023-06-17 10:32:00">2023-06-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="canvas学习"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="background-image: url('https://w.wallhaven.cc/full/9d/wallhaven-9d8ee1.jpg')"></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="01-认识canvas"><a href="#01-认识canvas" class="headerlink" title="01-认识canvas"></a>01-认识canvas</h1><p>身为一个WEB开发人员，肯定都是想着能够开发出酷炫和激动人心的应用程序来。可以很多动画特效，例如黑客帝国的数字，彩色炫酷的例子动效。也可以实现各种图画面板，如实现类似于photoshop的web在线图像编辑。各种酷炫的表单等等。</p>
<h2 id=""><a href="#" class="headerlink" title=" "></a> </h2><h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667114597950-85a1d0a9-63c7-4ef3-82fe-3a9340047826.png" alt="img"></p>
<p>画布是H5中一个重要的概念，它面向开发人员提供了非常底层的绘图接口，使得绘制速度可以大幅提高，这对游戏等领域极为重要。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1634643034769-157be8ec-b103-4574-84ab-8876ac728ffa.gif" alt="img"></p>
<p>本次课程中将非常系统和全面的详解canvas的各种属性和项目中的应用。并且以实战的案例如刮刮卡、抽奖转盘、表单饼图、画板、粒子特效等案例帮助大家真正掌握canvas并能写出各种特效和动画。</p>
<h2 id="-1"><a href="#-1" class="headerlink" title=" "></a> </h2><h2 id="canvas元素"><a href="#canvas元素" class="headerlink" title="canvas元素"></a>canvas元素</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;canvas id=&quot;tutorial&quot; width=&quot;150&quot; height=&quot;150&quot;&gt;&lt;/canvas&gt;</span><br></pre></td></tr></table></figure>
<p>canvas看起来和 img 元素很相像，唯一的不同就是它并没有 src 和 alt 属性。实际上，canvas 标签只有两个属性<strong>——</strong> width和height。这些都是可选的，并且同样利用 DOM properties 来设置。</p>
<p>当没有设置宽度和高度的时候，canvas 会初始化宽度为 300 像素和高度为 150 像素。该元素可以使用CSS来定义大小，但在绘制时图像会伸缩以适应它的框架尺寸：如果 CSS 的尺寸与初始画布的比例不一致，它会出现扭曲。</p>
<p>如果你绘制出来的图像是扭曲的，尝试用 width 和 height 属性为canvas明确规定宽高，而不是使用 CSS。</p>
<p>id属性并不是canvas元素所特有的，而是每一个 HTML 元素都默认具有的属性（比如 class 属性）。给每个标签都加上一个 id 属性是个好主意，因为这样你就能在我们的脚本中很容易的找到它。</p>
<p>canvas元素可以像任何一个普通的图像一样（有margin，border，background等等属性）被设计。然而，这些样式不会影响在 canvas 中的实际图像。我们将会在一个专门的章节里看到这是如何解决的。当开始时没有为 canvas 规定样式规则，其将会完全透明。</p>
<h3 id="-2"><a href="#-2" class="headerlink" title=" "></a> </h3><h3 id="替换内容"><a href="#替换内容" class="headerlink" title="替换内容"></a>替换内容</h3><p>canvas元素与img标签的不同之处在于，就像video，audio，或者 picture元素一样，很容易定义一些替代内容。由于某些较老的浏览器（尤其是 IE9 之前的 IE 浏览器）或者文本浏览器不支持 HTML  元素”canvas”，在这些浏览器上你应该总是能展示替代内容。</p>
<p>这非常简单：我们只是在canvas标签中提供了替换内容。不支持canvas的浏览器将会忽略容器并在其中渲染后备内容。而支持canvas的浏览器将会忽略在容器中包含的内容，并且只是正常渲染 canvas。</p>
<p>举个例子，我们可以提供对 canvas 内容的文字描述或者是提供动态生成内容相对应的静态图片，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;canvas id=&quot;stockGraph&quot; width=&quot;150&quot; height=&quot;150&quot;&gt;</span><br><span class="line">  current stock price: $3.15 +0.15</span><br><span class="line">&lt;/canvas&gt;</span><br><span class="line"></span><br><span class="line">&lt;canvas id=&quot;clock&quot; width=&quot;150&quot; height=&quot;150&quot;&gt;</span><br><span class="line">  &lt;img src=&quot;images/clock.png&quot; width=&quot;150&quot; height=&quot;150&quot; alt=&quot;&quot;/&gt;</span><br><span class="line">&lt;/canvas&gt;</span><br></pre></td></tr></table></figure>
<h3 id="结束标签不可省"><a href="#结束标签不可省" class="headerlink" title="结束标签不可省"></a>结束标签不可省</h3><p>与 img元素不同，canvas 元素<strong>需要</strong>结束标签 (<code>&lt;/canvas&gt;</code>)。如果结束标签不存在，则文档的其余部分会被认为是替代内容，将不会显示出来。</p>
<p>如果不需要替代内容，一个简单的<code>&lt;canvas id=&quot;foo&quot; ...&gt;&lt;/canvas&gt;</code>在所有支持 canvas 的浏览器中都是完全兼容的。</p>
<h2 id="-3"><a href="#-3" class="headerlink" title=" "></a> </h2><h2 id="渲染上下文（The-rendering-context）"><a href="#渲染上下文（The-rendering-context）" class="headerlink" title="渲染上下文（The rendering context）"></a>渲染上下文（The rendering context）</h2><p><code>&lt;canvas&gt;</code>元素创造了一个固定大小的画布，它公开了一个或多个<strong>渲染上下文</strong>，其可以用来绘制和处理要展示的内容。我们将会将注意力放在 2D 渲染上下文中。其他种类的上下文也许提供了不同种类的渲染方式；比如， WebGL 使用了基于OpenGL ES的 3D 上下文 (“webgl”) 。</p>
<p>canvas 起初是空白的。为了展示，首先脚本需要找到渲染上下文，然后在它的上面绘制。<code>&lt;canvas&gt;</code>元素有一个叫做 getContext() 的方法，这个方法是用来获得渲染上下文和它的绘画功能。getContext()接受一个参数，即上下文的类型。对于 2D 图像而言，如本教程，你可以使用 CanvasRenderingContext2D。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var canvas = document.getElementById(&#x27;tutorial&#x27;);</span><br><span class="line">var ctx = canvas.getContext(&#x27;2d&#x27;);</span><br></pre></td></tr></table></figure>
<p>代码的第一行通过使用 document.getElementById() 方法来为<code>&lt;canvas&gt;</code>元素得到 DOM 对象。一旦有了元素对象，你可以通过使用它的 getContext() 方法来访问绘画上下文。</p>
<h2 id="-4"><a href="#-4" class="headerlink" title=" "></a> </h2><h2 id="检查支持性"><a href="#检查支持性" class="headerlink" title="检查支持性"></a>检查支持性</h2><p>替换内容是用于在不支持<code>&lt;canvas&gt;</code>标签的浏览器中展示的。通过简单的测试 getContext() 方法的存在，脚本可以检查编程支持性。上面的代码片段现在变成了这个样子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;tutorial&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (canvas.<span class="property">getContext</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">  <span class="comment">// drawing code here</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// canvas-unsupported code here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="一个模板骨架"><a href="#一个模板骨架" class="headerlink" title="一个模板骨架"></a>一个模板骨架</h2><p>这里的是一个最简单的模板，我们之后就可以把它作为之后的例子的起点。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Canvas tutorial<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;tutorial&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (canvas.<span class="property">getContext</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">canvas</span> &#123; <span class="attribute">border</span>: <span class="number">1px</span> solid black; &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">&quot;draw();&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;tutorial&quot;</span> <span class="attr">width</span>=<span class="string">&quot;150&quot;</span> <span class="attr">height</span>=<span class="string">&quot;150&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面的脚本中包含一个叫做 draw()  的函数，当页面加载结束的时候就会执行这个函数。通过使用在文档上加载事件来完成。只要页面加载结束，这个函数，或者像是这个的，同样可以使用  window.setTimeout()(en-US)， window.setInterval()(en-US)，或者其他任何事件处理程序来调用。</p>
<p>模板看起来会是这样。如这里所示，它最初是空白的。</p>
<h2 id="-5"><a href="#-5" class="headerlink" title=" "></a> </h2><h2 id="一个简单例子"><a href="#一个简单例子" class="headerlink" title="一个简单例子"></a>一个简单例子</h2><p>一开始，让我们来看个简单的例子，我们绘制了两个有趣的长方形，其中的一个有着 alpha 透明度。我们将在接下来的例子里深入探索一下这是如何工作的。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;application/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;canvas&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (canvas.<span class="property">getContext</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          ctx.<span class="property">fillStyle</span> = <span class="string">&quot;rgb(200,0,0)&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">          ctx.<span class="property">fillRect</span> (<span class="number">10</span>, <span class="number">10</span>, <span class="number">55</span>, <span class="number">50</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          ctx.<span class="property">fillStyle</span> = <span class="string">&quot;rgba(0, 0, 200, 0.5)&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">          ctx.<span class="property">fillRect</span> (<span class="number">30</span>, <span class="number">30</span>, <span class="number">55</span>, <span class="number">50</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">&quot;draw();&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas&quot;</span> <span class="attr">width</span>=<span class="string">&quot;150&quot;</span> <span class="attr">height</span>=<span class="string">&quot;150&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667109836400-3a821caa-f061-4084-833e-e26de65f57fb.png" alt="img"></p>
<h1 id="01-canvas绘制基本图形"><a href="#01-canvas绘制基本图形" class="headerlink" title="01-canvas绘制基本图形"></a>01-canvas绘制基本图形</h1><p>既然我们已经设置了 canvas 环境，我们可以深入了解如何在 canvas 上绘制。到本文的最后，你将学会如何绘制矩形，三角形，直线，圆弧和曲线，变得熟悉这些基本的形状。绘制物体到 Canvas 前，需掌握路径，我们看看到底怎么做。</p>
<h2 id="-6"><a href="#-6" class="headerlink" title=" "></a> </h2><h2 id="栅格"><a href="#栅格" class="headerlink" title="栅格"></a>栅格</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667121349188-0130b309-19cf-49db-a6bb-c02ea6c317ed.png" alt="img"></p>
<p>在我们开始画图之前，我们需要了解一下画布栅格（canvas grid）以及坐标空间。上一页中的 HTML 模板中有个宽 150px, 高 150px 的 canvas 元素。如右图所示，canvas  元素默认被网格所覆盖。通常来说网格中的一个单元相当于 canvas  元素中的一像素。栅格的起点为左上角（坐标为（0,0））。所有元素的位置都相对于原点定位。所以图中蓝色方形左上角的坐标为距离左边（X 轴）x  像素，距离上边（Y 轴）y 像素（坐标为（x,y））。在课程的最后我们会平移原点到不同的坐标上，旋转网格以及缩放。现在我们还是使用原来的设置。</p>
<h2 id="-7"><a href="#-7" class="headerlink" title=" "></a> </h2><h2 id="绘制矩形"><a href="#绘制矩形" class="headerlink" title="绘制矩形"></a>绘制矩形</h2><p>不同于 SVG，canvas 只支持两种形式的图形绘制：矩形和路径（由一系列点连成的线段）。所有其他类型的图形都是通过一条或者多条路径组合而成的。不过，我们拥有众多路径生成的方法让复杂图形的绘制成为了可能。</p>
<p>首先，我们回到矩形的绘制中。canvas 提供了三种方法绘制矩形：</p>
<p>fillRect(x, y, width, height)</p>
<p>绘制一个填充的矩形</p>
<p>strokeRect(x, y, width, height)</p>
<p>绘制一个矩形的边框</p>
<p>clearRect(x, y, width, height)</p>
<p>清除指定矩形区域，让清除部分完全透明。</p>
<p>上面提供的方法之中每一个都包含了相同的参数。x 与 y 指定了在 canvas 画布上所绘制的矩形的左上角（相对于原点）的坐标。width 和 height 设置矩形的尺寸。</p>
<p>下面的 draw() 函数是前一页中取得的，现在就来使用上面的三个函数。</p>
<h3 id="-8"><a href="#-8" class="headerlink" title=" "></a> </h3><h3 id="矩形（Rectangular）例子"><a href="#矩形（Rectangular）例子" class="headerlink" title="矩形（Rectangular）例子"></a>矩形（Rectangular）例子</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (canvas.<span class="property">getContext</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    ctx.<span class="title function_">fillRect</span>(<span class="number">25</span>, <span class="number">25</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    ctx.<span class="title function_">clearRect</span>(<span class="number">45</span>, <span class="number">45</span>, <span class="number">60</span>, <span class="number">60</span>);</span><br><span class="line">    ctx.<span class="title function_">strokeRect</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667121532600-d949eddb-9dba-42db-82c2-0aa93b1fe19e.png" alt="img"></p>
<p>fillRect()函数绘制了一个边长为 100px 的黑色正方形。clearRect()函数从正方形的中心开始擦除了一个 60<em>60px 的正方形，接着strokeRect()在清除区域内生成一个 50</em>50 的正方形边框。</p>
<p>接下来我们能够看到 clearRect() 的两个可选方法，然后我们会知道如何改变渲染图形的填充颜色及描边颜色。</p>
<p>不同于下一节所要介绍的路径函数（path function），以上的三个函数绘制之后会马上显现在 canvas 上，即时生效。</p>
<h3 id="-9"><a href="#-9" class="headerlink" title=" "></a> </h3><h3 id="矩形"><a href="#矩形" class="headerlink" title="矩形"></a>矩形</h3><p>直接在画布上绘制矩形的三个额外方法，正如我们开始所见的绘制矩形，同样，也有 rect() 方法，将一个矩形路径增加到当前路径上。</p>
<p>rect(x, y, width, height)</p>
<p>绘制一个左上角坐标为（x,y），宽高为 width 以及 height 的矩形。</p>
<p>当该方法执行的时候，moveTo() 方法自动设置坐标参数（0,0）。也就是说，当前笔触自动重置回默认坐标。</p>
<h2 id="-10"><a href="#-10" class="headerlink" title=" "></a> </h2><h2 id="绘制路径"><a href="#绘制路径" class="headerlink" title="绘制路径"></a>绘制路径</h2><p>图形的基本元素是路径。路径是通过不同颜色和宽度的线段或曲线相连形成的不同形状的点的集合。一个路径，甚至一个子路径，都是闭合的。使用路径绘制图形需要一些额外的步骤。</p>
<ol>
<li>首先，你需要创建路径起始点。</li>
<li>然后你使用画图命令去画出路径。</li>
<li>之后你把路径封闭。</li>
<li>一旦路径生成，你就能通过描边或填充路径区域来渲染图形。</li>
</ol>
<p>以下是所要用到的函数：</p>
<p>beginPath()</p>
<p>新建一条路径，生成之后，图形绘制命令被指向到路径上生成路径。</p>
<p>closePath()</p>
<p>闭合路径之后图形绘制命令又重新指向到上下文中。</p>
<p>stroke()</p>
<p>通过线条来绘制图形轮廓。</p>
<p>fill()</p>
<p>通过填充路径的内容区域生成实心的图形。</p>
<p>生成路径的第一步叫做 beginPath()。本质上，路径是由很多子路径构成，这些子路径都是在一个列表中，所有的子路径（线、弧形、等等）构成图形。而每次这个方法调用之后，列表清空重置，然后我们就可以重新绘制新的图形。</p>
<p><strong>备注：</strong> 当前路径为空，即调用 beginPath() 之后，或者 canvas 刚建的时候，第一条路径构造命令通常被视为是 moveTo（），无论实际上是什么。出于这个原因，你几乎总是要在设置路径之后专门指定你的起始位置。</p>
<p>第二步就是调用函数指定绘制路径，本文稍后我们就能看到了。</p>
<p>第三，就是闭合路径 closePath(),不是必需的。这个方法会通过绘制一条从当前点到开始点的直线来闭合图形。如果图形是已经闭合了的，即当前点为开始点，该函数什么也不做。</p>
<p><strong>备注：</strong> 当你调用 fill() 函数时，所有没有闭合的形状都会自动闭合，所以你不需要调用 closePath() 函数。但是调用 stroke() 时不会自动闭合。</p>
<h3 id="-11"><a href="#-11" class="headerlink" title=" "></a> </h3><h3 id="绘制一个三角形"><a href="#绘制一个三角形" class="headerlink" title="绘制一个三角形"></a>绘制一个三角形</h3><p>例如，绘制三角形的代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (canvas.<span class="property">getContext</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">    ctx.<span class="title function_">moveTo</span>(<span class="number">75</span>, <span class="number">50</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">100</span>, <span class="number">75</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">100</span>, <span class="number">25</span>);</span><br><span class="line">    ctx.<span class="title function_">fill</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="移动笔触"><a href="#移动笔触" class="headerlink" title="移动笔触"></a>移动笔触</h3><p>一个非常有用的函数，而这个函数实际上并不能画出任何东西，也是上面所描述的路径列表的一部分，这个函数就是moveTo()。或者你可以想象一下在纸上作业，一支钢笔或者铅笔的笔尖从一个点到另一个点的移动过程。</p>
<p>moveTo(x, y)</p>
<p>将笔触移动到指定的坐标 x 以及 y 上。</p>
<p>当 canvas 初始化或者beginPath()调用后，你通常会使用moveTo()函数设置起点。我们也能够使用moveTo()绘制一些不连续的路径。看一下下面的笑脸例子。我将用到moveTo()方法（红线处）的地方标记了。</p>
<p>你可以尝试一下，使用下边的代码片。只需要将其复制到之前的draw()函数即可。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (canvas.<span class="property">getContext</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">    ctx.<span class="title function_">arc</span>(<span class="number">75</span>, <span class="number">75</span>, <span class="number">50</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">true</span>); <span class="comment">// 绘制</span></span><br><span class="line">    ctx.<span class="title function_">moveTo</span>(<span class="number">110</span>, <span class="number">75</span>);</span><br><span class="line">    ctx.<span class="title function_">arc</span>(<span class="number">75</span>, <span class="number">75</span>, <span class="number">35</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span>, <span class="literal">false</span>);   <span class="comment">// 口 (顺时针)</span></span><br><span class="line">    ctx.<span class="title function_">moveTo</span>(<span class="number">65</span>, <span class="number">65</span>);</span><br><span class="line">    ctx.<span class="title function_">arc</span>(<span class="number">60</span>, <span class="number">65</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">true</span>);  <span class="comment">// 左眼</span></span><br><span class="line">    ctx.<span class="title function_">moveTo</span>(<span class="number">95</span>, <span class="number">65</span>);</span><br><span class="line">    ctx.<span class="title function_">arc</span>(<span class="number">90</span>, <span class="number">65</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">true</span>);  <span class="comment">// 右眼</span></span><br><span class="line">    ctx.<span class="title function_">stroke</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667121749673-6dd96f71-4fc6-40a0-9b45-a036d4611a03.png" alt="img"></p>
<h3 id="-12"><a href="#-12" class="headerlink" title=" "></a> </h3><h3 id="线"><a href="#线" class="headerlink" title="线"></a>线</h3><p>绘制直线，需要用到的方法lineTo()。</p>
<p>lineTo(x, y)</p>
<p>绘制一条从当前位置到指定 x 以及 y 位置的直线。</p>
<p>该方法有两个参数：x 以及 y，代表坐标系中直线结束的点。开始点和之前的绘制路径有关，之前路径的结束点就是接下来的开始点，等等。。。开始点也可以通过moveTo()函数改变。</p>
<p>下面的例子绘制两个三角形，一个是填充的，另一个是描边的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (canvas.<span class="property">getContext</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 填充三角形</span></span><br><span class="line">  ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">  ctx.<span class="title function_">moveTo</span>(<span class="number">25</span>, <span class="number">25</span>);</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(<span class="number">105</span>, <span class="number">25</span>);</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(<span class="number">25</span>, <span class="number">105</span>);</span><br><span class="line">  ctx.<span class="title function_">fill</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 描边三角形</span></span><br><span class="line">  ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">  ctx.<span class="title function_">moveTo</span>(<span class="number">125</span>, <span class="number">125</span>);</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(<span class="number">125</span>, <span class="number">45</span>);</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(<span class="number">45</span>, <span class="number">125</span>);</span><br><span class="line">  ctx.<span class="title function_">closePath</span>();</span><br><span class="line">  ctx.<span class="title function_">stroke</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里从调用beginPath()函数准备绘制一个新的形状路径开始。然后使用moveTo()函数移动到目标位置上。然后下面，两条线段绘制后构成三角形的两条边。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667121985104-5a86c456-016e-4028-bf7c-dd5aec14612e.png" alt="img"></p>
<h3 id="-13"><a href="#-13" class="headerlink" title=" "></a> </h3><h3 id="圆弧"><a href="#圆弧" class="headerlink" title="圆弧"></a>圆弧</h3><p>绘制圆弧或者圆，我们使用arc()方法。当然可以使用arcTo()，不过这个的实现并不是那么的可靠，所以我们这里不作介绍。</p>
<p>arc(x, y, radius, startAngle, endAngle, anticlockwise)</p>
<p>画一个以（x,y）为圆心的以 radius 为半径的圆弧（圆），从 startAngle 开始到 endAngle 结束，按照 anticlockwise 给定的方向（默认为顺时针）来生成。</p>
<p>arcTo(x1, y1, x2, y2, radius)</p>
<p>根据给定的控制点和半径画一段圆弧，再以直线连接两个控制点。</p>
<p>这里详细介绍一下 arc  方法，该方法有六个参数：x,y为绘制圆弧所在圆上的圆心坐标。radius为半径。startAngle以及endAngle参数用弧度定义了开始以及结束的弧度。这些都是以 x 轴为基准。参数anticlockwise为一个布尔值。为 true 时，是逆时针方向，否则顺时针方向。</p>
<p><strong>备注：</strong> arc() 函数中表示角的单位是弧度，不是角度。角度与弧度的 js 表达式：</p>
<p><strong>弧度=(Math.PI/180)*角度。</strong></p>
<p>下面的例子比上面的要复杂一下，下面绘制了 12 个不同的角度以及填充的圆弧。</p>
<p>下面两个for循环，生成圆弧的行列（x,y）坐标。每一段圆弧的开始都调用beginPath()。代码中，每个圆弧的参数都是可变的，实际编程中，我们并不需要这样做。</p>
<p>x,y 坐标是可变的。半径（radius）和开始角度（startAngle）都是固定的。结束角度（endAngle）在第一列开始时是 180 度（半圆）然后每列增加 90 度。最后一列形成一个完整的圆。</p>
<p>clockwise语句作用于第一、三行是顺时针的圆弧，anticlockwise作用于二、四行为逆时针圆弧。if语句让一、二行描边圆弧，下面两行填充路径。</p>
<p><strong>备注：</strong> 这个示例所需的画布大小略大于本页面的其他例子：150 x 200 像素。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (canvas.<span class="property">getContext</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)&#123;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)&#123;</span><br><span class="line">        ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">        <span class="keyword">var</span> x = <span class="number">25</span> + j * <span class="number">50</span>; <span class="comment">// x 坐标值</span></span><br><span class="line">        <span class="keyword">var</span> y = <span class="number">25</span> + i * <span class="number">50</span>; <span class="comment">// y 坐标值</span></span><br><span class="line">        <span class="keyword">var</span> radius = <span class="number">20</span>; <span class="comment">// 圆弧半径</span></span><br><span class="line">        <span class="keyword">var</span> startAngle = <span class="number">0</span>; <span class="comment">// 开始点</span></span><br><span class="line">        <span class="keyword">var</span> endAngle = <span class="title class_">Math</span>.<span class="property">PI</span> + (<span class="title class_">Math</span>.<span class="property">PI</span> * j) / <span class="number">2</span>; <span class="comment">// 结束点</span></span><br><span class="line">        <span class="keyword">var</span> anticlockwise = i % <span class="number">2</span> == <span class="number">0</span> ? <span class="literal">false</span> : <span class="literal">true</span>; <span class="comment">// 顺时针或逆时针</span></span><br><span class="line"></span><br><span class="line">        ctx.<span class="title function_">arc</span>(x, y, radius, startAngle, endAngle, anticlockwise);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (i&gt;<span class="number">1</span>)&#123;</span><br><span class="line">          ctx.<span class="title function_">fill</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          ctx.<span class="title function_">stroke</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667122114277-99e48d4d-a449-41d9-96f4-e9e4373fb239.png" alt="img"></p>
<h3 id="-14"><a href="#-14" class="headerlink" title=" "></a> </h3><h3 id="使用arcTo方法"><a href="#使用arcTo方法" class="headerlink" title="使用arcTo方法"></a>使用arcTo方法</h3><p>这是一段绘制圆弧的简单的代码片段。基础点是蓝色的，两个控制点是红色的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line"></span><br><span class="line">ctx.<span class="title function_">setLineDash</span>([])</span><br><span class="line">ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">ctx.<span class="title function_">moveTo</span>(<span class="number">150</span>, <span class="number">20</span>);</span><br><span class="line">ctx.<span class="title function_">arcTo</span>(<span class="number">150</span>,<span class="number">100</span>,<span class="number">50</span>,<span class="number">20</span>,<span class="number">30</span>);</span><br><span class="line">ctx.<span class="title function_">stroke</span>();</span><br><span class="line"></span><br><span class="line">ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;blue&#x27;</span>;</span><br><span class="line"><span class="comment">// base point</span></span><br><span class="line">ctx.<span class="title function_">fillRect</span>(<span class="number">150</span>, <span class="number">20</span>, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;red&#x27;</span>;</span><br><span class="line"><span class="comment">// control point one</span></span><br><span class="line">ctx.<span class="title function_">fillRect</span>(<span class="number">150</span>, <span class="number">100</span>, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line"><span class="comment">// control point two</span></span><br><span class="line">ctx.<span class="title function_">fillRect</span>(<span class="number">50</span>, <span class="number">20</span>, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">ctx.<span class="title function_">setLineDash</span>([<span class="number">5</span>,<span class="number">5</span>])</span><br><span class="line">ctx.<span class="title function_">moveTo</span>(<span class="number">150</span>, <span class="number">20</span>);</span><br><span class="line">ctx.<span class="title function_">lineTo</span>(<span class="number">150</span>,<span class="number">100</span>);</span><br><span class="line">ctx.<span class="title function_">lineTo</span>(<span class="number">50</span>, <span class="number">20</span>);</span><br><span class="line">ctx.<span class="title function_">stroke</span>();</span><br><span class="line">ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">ctx.<span class="title function_">arc</span>(<span class="number">120</span>,<span class="number">38</span>,<span class="number">30</span>,<span class="number">0</span>,<span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>);</span><br><span class="line">ctx.<span class="title function_">stroke</span>();</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667149844431-6d0f587b-e7e9-426f-b651-9a77a9bc0758.png" alt="img"></p>
<h3 id="-15"><a href="#-15" class="headerlink" title=" "></a> </h3><h3 id="二次贝塞尔曲线及三次贝塞尔曲线"><a href="#二次贝塞尔曲线及三次贝塞尔曲线" class="headerlink" title="二次贝塞尔曲线及三次贝塞尔曲线"></a>二次贝塞尔曲线及三次贝塞尔曲线</h3><p>下一个十分有用的路径类型就是贝塞尔曲线。二次及三次贝塞尔曲线都十分有用，一般用来绘制复杂有规律的图形。</p>
<p>quadraticCurveTo(cp1x, cp1y, x, y)</p>
<p>绘制二次贝塞尔曲线，cp1x,cp1y 为一个控制点，x,y 为结束点。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667150886162-f5d91ebd-e23a-4468-9749-f20c62dbd7d1.gif" alt="img"></p>
<p>bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y)</p>
<p>绘制三次贝塞尔曲线，cp1x,cp1y为控制点一，cp2x,cp2y为控制点二，x,y为结束点。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667150992425-4cd7f759-76d7-466d-836a-1be44e801f83.gif" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667122134189-e9cef021-bf64-4c7f-8bac-15f594a61899.png" alt="img"></p>
<p>右边的图能够很好的描述两者的关系，二次贝塞尔曲线有一个开始点（蓝色）、一个结束点（蓝色）以及一个控制点（红色），而三次贝塞尔曲线有两个控制点。</p>
<p>参数 x、y 在这两个方法中都是结束点坐标。cp1x,cp1y为坐标中的第一个控制点，cp2x,cp2y为坐标中的第二个控制点。</p>
<p>使用二次以及三次贝塞尔曲线是有一定的难度的，因为不同于像 Adobe Illustrators  这样的矢量软件，我们所绘制的曲线没有给我们提供直接的视觉反馈。这让绘制复杂的图形变得十分困难。在下面的例子中，我们会绘制一些简单有规律的图形，如果你有时间以及更多的耐心，很多复杂的图形你也可以绘制出来。</p>
<p>下面的这些例子没有多少困难。这两个例子中我们会连续绘制贝塞尔曲线，最后形成复杂的图形。</p>
<h4 id="-16"><a href="#-16" class="headerlink" title=" "></a> </h4><h4 id="二次贝塞尔曲线"><a href="#二次贝塞尔曲线" class="headerlink" title="二次贝塞尔曲线"></a>二次贝塞尔曲线</h4><p>这个例子使用多个贝塞尔曲线来渲染对话气泡。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (canvas.<span class="property">getContext</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 二次贝塞尔曲线</span></span><br><span class="line">    ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">    ctx.<span class="title function_">moveTo</span>(<span class="number">75</span>, <span class="number">25</span>);</span><br><span class="line">    ctx.<span class="title function_">quadraticCurveTo</span>(<span class="number">25</span>, <span class="number">25</span>, <span class="number">25</span>, <span class="number">62.5</span>);</span><br><span class="line">    ctx.<span class="title function_">quadraticCurveTo</span>(<span class="number">25</span>, <span class="number">100</span>, <span class="number">50</span>, <span class="number">100</span>);</span><br><span class="line">    ctx.<span class="title function_">quadraticCurveTo</span>(<span class="number">50</span>, <span class="number">120</span>, <span class="number">30</span>, <span class="number">125</span>);</span><br><span class="line">    ctx.<span class="title function_">quadraticCurveTo</span>(<span class="number">60</span>, <span class="number">120</span>, <span class="number">65</span>, <span class="number">100</span>);</span><br><span class="line">    ctx.<span class="title function_">quadraticCurveTo</span>(<span class="number">125</span>, <span class="number">100</span>, <span class="number">125</span>, <span class="number">62.5</span>);</span><br><span class="line">    ctx.<span class="title function_">quadraticCurveTo</span>(<span class="number">125</span>, <span class="number">25</span>, <span class="number">75</span>, <span class="number">25</span>);</span><br><span class="line">    ctx.<span class="title function_">stroke</span>();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667122154132-c116486b-a8a9-4c8a-9cbc-b4531d40c3f4.png" alt="img"></p>
<h4 id="-17"><a href="#-17" class="headerlink" title=" "></a> </h4><h4 id="三次贝塞尔曲线"><a href="#三次贝塞尔曲线" class="headerlink" title="三次贝塞尔曲线"></a>三次贝塞尔曲线</h4><p>这个例子使用贝塞尔曲线绘制心形。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (canvas.<span class="property">getContext</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//三次贝塞尔曲线</span></span><br><span class="line">    ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">    ctx.<span class="title function_">moveTo</span>(<span class="number">75</span>, <span class="number">40</span>);</span><br><span class="line">    ctx.<span class="title function_">bezierCurveTo</span>(<span class="number">75</span>, <span class="number">37</span>, <span class="number">70</span>, <span class="number">25</span>, <span class="number">50</span>, <span class="number">25</span>);</span><br><span class="line">    ctx.<span class="title function_">bezierCurveTo</span>(<span class="number">20</span>, <span class="number">25</span>, <span class="number">20</span>, <span class="number">62.5</span>, <span class="number">20</span>, <span class="number">62.5</span>);</span><br><span class="line">    ctx.<span class="title function_">bezierCurveTo</span>(<span class="number">20</span>, <span class="number">80</span>, <span class="number">40</span>, <span class="number">102</span>, <span class="number">75</span>, <span class="number">120</span>);</span><br><span class="line">    ctx.<span class="title function_">bezierCurveTo</span>(<span class="number">110</span>, <span class="number">102</span>, <span class="number">130</span>, <span class="number">80</span>, <span class="number">130</span>, <span class="number">62.5</span>);</span><br><span class="line">    ctx.<span class="title function_">bezierCurveTo</span>(<span class="number">130</span>, <span class="number">62.5</span>, <span class="number">130</span>, <span class="number">25</span>, <span class="number">100</span>, <span class="number">25</span>);</span><br><span class="line">    ctx.<span class="title function_">bezierCurveTo</span>(<span class="number">85</span>, <span class="number">25</span>, <span class="number">75</span>, <span class="number">37</span>, <span class="number">75</span>, <span class="number">40</span>);</span><br><span class="line">    ctx.<span class="title function_">fill</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667122230252-a53a7ed2-b4bf-4c36-9f5b-2bd2ca783432.png" alt="img"></p>
<h3 id="-18"><a href="#-18" class="headerlink" title=" "></a> </h3><h3 id="组合使用"><a href="#组合使用" class="headerlink" title="组合使用"></a>组合使用</h3><p>目前为止，每一个例子中的每个图形都只用到一种类型的路径。然而，绘制一个图形并没有限制使用数量以及类型。所以在最后的一个例子里，让我们组合使用所有的路径函数来重现一款著名的游戏。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (canvas.<span class="property">getContext</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">roundedRect</span>(ctx, <span class="number">12</span>, <span class="number">12</span>, <span class="number">150</span>, <span class="number">150</span>, <span class="number">15</span>);</span><br><span class="line">    <span class="title function_">roundedRect</span>(ctx, <span class="number">19</span>, <span class="number">19</span>, <span class="number">150</span>, <span class="number">150</span>, <span class="number">9</span>);</span><br><span class="line">    <span class="title function_">roundedRect</span>(ctx, <span class="number">53</span>, <span class="number">53</span>, <span class="number">49</span>, <span class="number">33</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="title function_">roundedRect</span>(ctx, <span class="number">53</span>, <span class="number">119</span>, <span class="number">49</span>, <span class="number">16</span>, <span class="number">6</span>);</span><br><span class="line">    <span class="title function_">roundedRect</span>(ctx, <span class="number">135</span>, <span class="number">53</span>, <span class="number">49</span>, <span class="number">33</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="title function_">roundedRect</span>(ctx, <span class="number">135</span>, <span class="number">119</span>, <span class="number">25</span>, <span class="number">49</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">    ctx.<span class="title function_">arc</span>(<span class="number">37</span>, <span class="number">37</span>, <span class="number">13</span>, <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">7</span>, -<span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">7</span>, <span class="literal">false</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">31</span>, <span class="number">37</span>);</span><br><span class="line">    ctx.<span class="title function_">fill</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)&#123;</span><br><span class="line">      ctx.<span class="title function_">fillRect</span>(<span class="number">51</span> + i * <span class="number">16</span>, <span class="number">35</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)&#123;</span><br><span class="line">      ctx.<span class="title function_">fillRect</span>(<span class="number">115</span>, <span class="number">51</span> + i * <span class="number">16</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)&#123;</span><br><span class="line">      ctx.<span class="title function_">fillRect</span>(<span class="number">51</span> + i * <span class="number">16</span>, <span class="number">99</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">    ctx.<span class="title function_">moveTo</span>(<span class="number">83</span>, <span class="number">116</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">83</span>, <span class="number">102</span>);</span><br><span class="line">    ctx.<span class="title function_">bezierCurveTo</span>(<span class="number">83</span>, <span class="number">94</span>, <span class="number">89</span>, <span class="number">88</span>, <span class="number">97</span>, <span class="number">88</span>);</span><br><span class="line">    ctx.<span class="title function_">bezierCurveTo</span>(<span class="number">105</span>, <span class="number">88</span>, <span class="number">111</span>, <span class="number">94</span>, <span class="number">111</span>, <span class="number">102</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">111</span>, <span class="number">116</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">106.333</span>, <span class="number">111.333</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">101.666</span>, <span class="number">116</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">97</span>, <span class="number">111.333</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">92.333</span>, <span class="number">116</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">87.666</span>, <span class="number">111.333</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">83</span>, <span class="number">116</span>);</span><br><span class="line">    ctx.<span class="title function_">fill</span>();</span><br><span class="line"></span><br><span class="line">    ctx.<span class="property">fillStyle</span> = <span class="string">&quot;white&quot;</span>;</span><br><span class="line">    ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">    ctx.<span class="title function_">moveTo</span>(<span class="number">91</span>, <span class="number">96</span>);</span><br><span class="line">    ctx.<span class="title function_">bezierCurveTo</span>(<span class="number">88</span>, <span class="number">96</span>, <span class="number">87</span>, <span class="number">99</span>, <span class="number">87</span>, <span class="number">101</span>);</span><br><span class="line">    ctx.<span class="title function_">bezierCurveTo</span>(<span class="number">87</span>, <span class="number">103</span>, <span class="number">88</span>, <span class="number">106</span>, <span class="number">91</span>, <span class="number">106</span>);</span><br><span class="line">    ctx.<span class="title function_">bezierCurveTo</span>(<span class="number">94</span>, <span class="number">106</span>, <span class="number">95</span>, <span class="number">103</span>, <span class="number">95</span>, <span class="number">101</span>);</span><br><span class="line">    ctx.<span class="title function_">bezierCurveTo</span>(<span class="number">95</span>, <span class="number">99</span>, <span class="number">94</span>, <span class="number">96</span>, <span class="number">91</span>, <span class="number">96</span>);</span><br><span class="line">    ctx.<span class="title function_">moveTo</span>(<span class="number">103</span>, <span class="number">96</span>);</span><br><span class="line">    ctx.<span class="title function_">bezierCurveTo</span>(<span class="number">100</span>, <span class="number">96</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">101</span>);</span><br><span class="line">    ctx.<span class="title function_">bezierCurveTo</span>(<span class="number">99</span>, <span class="number">103</span>, <span class="number">100</span>, <span class="number">106</span>, <span class="number">103</span>, <span class="number">106</span>);</span><br><span class="line">    ctx.<span class="title function_">bezierCurveTo</span>(<span class="number">106</span>, <span class="number">106</span>, <span class="number">107</span>, <span class="number">103</span>, <span class="number">107</span>, <span class="number">101</span>);</span><br><span class="line">    ctx.<span class="title function_">bezierCurveTo</span>(<span class="number">107</span>, <span class="number">99</span>, <span class="number">106</span>, <span class="number">96</span>, <span class="number">103</span>, <span class="number">96</span>);</span><br><span class="line">    ctx.<span class="title function_">fill</span>();</span><br><span class="line"></span><br><span class="line">    ctx.<span class="property">fillStyle</span> = <span class="string">&quot;black&quot;</span>;</span><br><span class="line">    ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">    ctx.<span class="title function_">arc</span>(<span class="number">101</span>, <span class="number">102</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">true</span>);</span><br><span class="line">    ctx.<span class="title function_">fill</span>();</span><br><span class="line"></span><br><span class="line">    ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">    ctx.<span class="title function_">arc</span>(<span class="number">89</span>, <span class="number">102</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">true</span>);</span><br><span class="line">    ctx.<span class="title function_">fill</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 封装的一个用于绘制圆角矩形的函数。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">roundedRect</span>(<span class="params">ctx, x, y, width, height, radius</span>)&#123;</span><br><span class="line">  ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">  ctx.<span class="title function_">moveTo</span>(x, y + radius);</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(x, y + height - radius);</span><br><span class="line">  ctx.<span class="title function_">quadraticCurveTo</span>(x, y + height, x + radius, y + height);</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(x + width - radius, y + height);</span><br><span class="line">  ctx.<span class="title function_">quadraticCurveTo</span>(x + width, y + height, x + width, y + height - radius);</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(x + width, y + radius);</span><br><span class="line">  ctx.<span class="title function_">quadraticCurveTo</span>(x + width, y, x + width - radius, y);</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(x + radius, y);</span><br><span class="line">  ctx.<span class="title function_">quadraticCurveTo</span>(x, y, x, y + radius);</span><br><span class="line">  ctx.<span class="title function_">stroke</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们不会很详细地讲解上面的代码，因为事实上这很容易理解。重点是绘制上下文中使用到了 fillStyle 属性，以及封装函数（例子中的roundedRect()）。使用封装函数对于减少代码量以及复杂度十分有用。</p>
<p>在稍后的课程里，我们会讨论fillStyle样式的更多细节。这章节中，我们对fillStyle样式所做的仅是改变填充颜色，由默认的黑色到白色，然后又是黑色。</p>
<h2 id="-19"><a href="#-19" class="headerlink" title=" "></a> </h2><h2 id="Path2D-对象"><a href="#Path2D-对象" class="headerlink" title="Path2D 对象"></a>Path2D 对象</h2><p>正如我们在前面例子中看到的，你可以使用一系列的路径和绘画命令来把对象“画”在画布上。为了简化代码和提高性能，Path2D对象已可以在较新版本的浏览器中使用，用来缓存或记录绘画命令，这样你将能快速地回顾路径。</p>
<p>怎样产生一个 Path2D 对象呢？</p>
<p>Path2D()</p>
<p>Path2D()会返回一个新初始化的 Path2D 对象（可能将某一个路径作为变量——创建一个它的副本，或者将一个包含 SVG path 数据的字符串作为变量）。</p>
<p>所有的路径方法比如moveTo, rect, arc或quadraticCurveTo等，如我们前面见过的，都可以在 Path2D 中使用。</p>
<p>Path2D API 添加了 addPath作为将path结合起来的方法。当你想要从几个元素中来创建对象时，这将会很实用。比如：</p>
<p>Path2D.addPath(path [, transform])</p>
<p>添加了一条路径到当前路径（可能添加了一个变换矩阵）。</p>
<h3 id="-20"><a href="#-20" class="headerlink" title=" "></a> </h3><h3 id="Path2D-示例"><a href="#Path2D-示例" class="headerlink" title="Path2D 示例"></a>Path2D 示例</h3><p>在这个例子中，我们创造了一个矩形和一个圆。它们都被存为 Path2D 对象，后面再派上用场。随着新的 Path2D API 产生，几种方法也相应地被更新来使用 Path2D  对象而不是当前路径。在这里，带路径参数的stroke和fill可以把对象画在画布上。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (canvas.<span class="property">getContext</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> rectangle = <span class="keyword">new</span> <span class="title class_">Path2D</span>();</span><br><span class="line">    rectangle.<span class="title function_">rect</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> circle = <span class="keyword">new</span> <span class="title class_">Path2D</span>();</span><br><span class="line">    circle.<span class="title function_">moveTo</span>(<span class="number">125</span>, <span class="number">35</span>);</span><br><span class="line">    circle.<span class="title function_">arc</span>(<span class="number">100</span>, <span class="number">35</span>, <span class="number">25</span>, <span class="number">0</span>, <span class="number">2</span> * <span class="title class_">Math</span>.<span class="property">PI</span>);</span><br><span class="line"></span><br><span class="line">    ctx.<span class="title function_">stroke</span>(rectangle);</span><br><span class="line">    ctx.<span class="title function_">fill</span>(circle);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667122399198-5dbffae0-64b1-4130-912a-dfef2786941e.png" alt="img"></p>
<h3 id="-21"><a href="#-21" class="headerlink" title=" "></a> </h3><h3 id="使用-SVG-paths"><a href="#使用-SVG-paths" class="headerlink" title="使用 SVG paths"></a>使用 SVG paths</h3><p>新的 Path2D API 有另一个强大的特点，就是使用 SVG path data 来初始化 canvas 上的路径。这将使你获取路径时可以以 SVG 或 canvas 的方式来重用它们。</p>
<p>这条路径将先移动到点 (M10 10) 然后再水平移动 80 个单位(h 80)，然后下移 80 个单位 (v 80)，接着左移 80 个单位 (h -80)，再回到起点处 (z)。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Path2D</span>(<span class="string">&quot;M10 10 h 80 v 80 h -80 Z&quot;</span>);</span><br></pre></td></tr></table></figure>
<h1 id="02-样式和颜色控制"><a href="#02-样式和颜色控制" class="headerlink" title="02-样式和颜色控制"></a>02-样式和颜色控制</h1><p>在绘制图形的章节里，我只用到默认的线条和填充样式。而在这一章里，我们将会探讨 canvas 全部的可选项，来绘制出更加吸引人的内容。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667177252309-650341b3-390e-4dc9-a092-d365f7d575bf.png" alt="img"></p>
<h2 id="-22"><a href="#-22" class="headerlink" title=" "></a> </h2><h2 id="色彩-Colors"><a href="#色彩-Colors" class="headerlink" title="色彩 Colors"></a>色彩 Colors</h2><p>到目前为止，我们只看到过绘制内容的方法。如果我们想要给图形上色，有两个重要的属性可以做到：fillStyle 和 strokeStyle。</p>
<p>fillStyle = color</p>
<p>设置图形的填充颜色。</p>
<p>strokeStyle = color</p>
<p>设置图形轮廓的颜色。</p>
<p>color 可以是表示 CSS 颜色值的字符串，渐变对象或者图案对象。我们迟些再回头探讨渐变和图案对象。默认情况下，线条和填充颜色都是黑色（CSS 颜色值 #000000）。</p>
<p><strong>备注：</strong> 一旦您设置了 strokeStyle 或者 fillStyle 的值，那么这个新值就会成为新绘制的图形的默认值。如果你要给每个图形上不同的颜色，你需要重新设置 fillStyle 或 strokeStyle 的值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这些 fillStyle 的值均为 &#x27;橙色&#x27;</span></span><br><span class="line">ctx.<span class="property">fillStyle</span> = <span class="string">&quot;orange&quot;</span>;</span><br><span class="line">ctx.<span class="property">fillStyle</span> = <span class="string">&quot;#FFA500&quot;</span>;</span><br><span class="line">ctx.<span class="property">fillStyle</span> = <span class="string">&quot;rgb(255,165,0)&quot;</span>;</span><br><span class="line">ctx.<span class="property">fillStyle</span> = <span class="string">&quot;rgba(255,165,0,1)&quot;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="fillStyle示例"><a href="#fillStyle示例" class="headerlink" title="fillStyle示例"></a>fillStyle示例</h3><p>在本示例里，我会再度用两层 for 循环来绘制方格阵列，每个方格不同的颜色。结果如右图，但实现所用的代码却没那么绚丽。我用了两个变量 i 和 j 来为每一个方格产生唯一的 RGB  色彩值，其中仅修改红色和绿色通道的值，而保持蓝色通道的值不变。你可以通过修改这些颜色通道的值来产生各种各样的色板。通过增加渐变的频率，你还可以绘制出类似 Photoshop 里面的那样的调色板。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;<span class="number">6</span>;j++)&#123;</span><br><span class="line">      ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;rgb(&#x27;</span> + <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="number">255</span>-<span class="number">42.5</span>*i) + <span class="string">&#x27;,&#x27;</span> +</span><br><span class="line">                       <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="number">255</span>-<span class="number">42.5</span>*j) + <span class="string">&#x27;,0)&#x27;</span>;</span><br><span class="line">      ctx.<span class="title function_">fillRect</span>(j*<span class="number">25</span>,i*<span class="number">25</span>,<span class="number">25</span>,<span class="number">25</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="strokeStyle示例"><a href="#strokeStyle示例" class="headerlink" title="strokeStyle示例"></a>strokeStyle示例</h3><p>这个示例与上面的有点类似，但这次用到的是 strokeStyle 属性，画的不是方格，而是用 arc 方法来画圆。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;<span class="number">6</span>;j++)&#123;</span><br><span class="line">      ctx.<span class="property">strokeStyle</span> = <span class="string">&#x27;rgb(0,&#x27;</span> + <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="number">255</span>-<span class="number">42.5</span>*i) + <span class="string">&#x27;,&#x27;</span> +</span><br><span class="line">                       <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="number">255</span>-<span class="number">42.5</span>*j) + <span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">      ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">      ctx.<span class="title function_">arc</span>(<span class="number">12.5</span>+j*<span class="number">25</span>,<span class="number">12.5</span>+i*<span class="number">25</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>,<span class="literal">true</span>);</span><br><span class="line">      ctx.<span class="title function_">stroke</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="透明度-Transparency"><a href="#透明度-Transparency" class="headerlink" title="透明度 Transparency"></a>透明度 Transparency</h2><p>除了可以绘制实色图形，我们还可以用 canvas 来绘制半透明的图形。通过设置 globalAlpha 属性或者使用一个半透明颜色作为轮廓或填充的样式。</p>
<p>globalAlpha = transparencyValue</p>
<p>这个属性影响到 canvas 里所有图形的透明度，有效的值范围是 0.0（完全透明）到 1.0（完全不透明），默认是 1.0。</p>
<p>globalAlpha 属性在需要绘制大量拥有相同透明度的图形时候相当高效。不过，我认为下面的方法可操作性更强一点。</p>
<p>因为 strokeStyle 和 fillStyle 属性接受符合 CSS 3 规范的颜色值，那我们可以用下面的写法来设置具有透明度的颜色。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定透明颜色，用于描边和填充样式</span></span><br><span class="line">ctx.<span class="property">strokeStyle</span> = <span class="string">&quot;rgba(255,0,0,0.5)&quot;</span>;</span><br><span class="line">ctx.<span class="property">fillStyle</span> = <span class="string">&quot;rgba(255,0,0,0.5)&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>rgba() 方法与 rgb() 方法类似，就多了一个用于设置色彩透明度的参数。它的有效范围是从 0.0（完全透明）到 1.0（完全不透明）。</p>
<h3 id="-23"><a href="#-23" class="headerlink" title=" "></a> </h3><h3 id="globalAlpha示例"><a href="#globalAlpha示例" class="headerlink" title="globalAlpha示例"></a>globalAlpha示例</h3><p>在这个例子里，将用四色格作为背景，设置 globalAlpha 为 0.2  后，在上面画一系列半径递增的半透明圆。最终结果是一个径向渐变效果。圆叠加得越更多，原先所画的圆的透明度会越低。通过增加循环次数，画更多的圆，从中心到边缘部分，背景图会呈现逐渐消失的效果。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">  <span class="comment">// 画背景</span></span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;#FD0&#x27;</span>;</span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">75</span>,<span class="number">75</span>);</span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;#6C0&#x27;</span>;</span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">75</span>,<span class="number">0</span>,<span class="number">75</span>,<span class="number">75</span>);</span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;#09F&#x27;</span>;</span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>,<span class="number">75</span>,<span class="number">75</span>,<span class="number">75</span>);</span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;#F30&#x27;</span>;</span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">75</span>,<span class="number">75</span>,<span class="number">75</span>,<span class="number">75</span>);</span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;#FFF&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置透明度值</span></span><br><span class="line">  ctx.<span class="property">globalAlpha</span> = <span class="number">0.2</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 画半透明圆</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">7</span>;i++)&#123;</span><br><span class="line">      ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">      ctx.<span class="title function_">arc</span>(<span class="number">75</span>,<span class="number">75</span>,<span class="number">10</span>+<span class="number">10</span>*i,<span class="number">0</span>,<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>,<span class="literal">true</span>);</span><br><span class="line">      ctx.<span class="title function_">fill</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667122746594-d65213b9-8b1b-4bc1-9bde-9d949af11d8d.png" alt="img"></p>
<h3 id="-24"><a href="#-24" class="headerlink" title=" "></a> </h3><h3 id="rgba-示例"><a href="#rgba-示例" class="headerlink" title="rgba()示例"></a>rgba()示例</h3><p>第二个例子和上面那个类似，不过不是画圆，而是画矩形。这里还可以看出，rgba() 可以分别设置轮廓和填充样式，因而具有更好的可操作性和使用灵活性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 画背景</span></span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;rgb(255,221,0)&#x27;</span>;</span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">150</span>,<span class="number">37.5</span>);</span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;rgb(102,204,0)&#x27;</span>;</span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>,<span class="number">37.5</span>,<span class="number">150</span>,<span class="number">37.5</span>);</span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;rgb(0,153,255)&#x27;</span>;</span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>,<span class="number">75</span>,<span class="number">150</span>,<span class="number">37.5</span>);</span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;rgb(255,51,0)&#x27;</span>;</span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>,<span class="number">112.5</span>,<span class="number">150</span>,<span class="number">37.5</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 画半透明矩形</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">    ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;rgba(255,255,255,&#x27;</span>+(i+<span class="number">1</span>)/<span class="number">10</span>+<span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;<span class="number">4</span>;j++)&#123;</span><br><span class="line">      ctx.<span class="title function_">fillRect</span>(<span class="number">5</span>+i*<span class="number">14</span>,<span class="number">5</span>+j*<span class="number">37.5</span>,<span class="number">14</span>,<span class="number">27.5</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667122772053-b4534f0f-3286-4e1a-a7ba-5344a6e39e80.png" alt="img"></p>
<h2 id="-25"><a href="#-25" class="headerlink" title=" "></a> </h2><h2 id="线型-Line-styles"><a href="#线型-Line-styles" class="headerlink" title="线型 Line styles"></a>线型 Line styles</h2><p>可以通过一系列属性来设置线的样式。</p>
<p>lineWidth = value</p>
<p>设置线条宽度。</p>
<p>lineCap = type</p>
<p>设置线条末端样式。</p>
<p>lineJoin = type</p>
<p>设定线条与线条间接合处的样式。</p>
<p>miterLimit = value</p>
<p>限制当两条线相交时交接处最大长度；所谓交接处长度（斜接长度）是指线条交接处内角顶点到外角顶点的长度。</p>
<p>getLineDash()</p>
<p>返回一个包含当前虚线样式，长度为非负偶数的数组。</p>
<p>setLineDash(segments)</p>
<p>设置当前虚线样式。</p>
<p>lineDashOffset = value</p>
<p>设置虚线样式的起始偏移量。</p>
<p>通过以下的样例可能会更加容易理解。</p>
<h4 id="-26"><a href="#-26" class="headerlink" title=" "></a> </h4><h4 id="lineWidth-属性的例子"><a href="#lineWidth-属性的例子" class="headerlink" title="lineWidth 属性的例子"></a>lineWidth 属性的例子</h4><p>这个属性设置当前绘线的粗细。属性值必须为正数。默认值是 1.0。</p>
<p>线宽是指给定路径的中心到两边的粗细。换句话说就是在路径的两边各绘制线宽的一半。因为画布的坐标并不和像素直接对应，当需要获得精确的水平或垂直线的时候要特别注意。</p>
<p>在下面的例子中，用递增的宽度绘制了 10 条直线。最左边的线宽 1.0 单位。并且，最左边的以及所有宽度为奇数的线并不能精确呈现，这就是因为路径的定位问题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">    ctx.<span class="property">lineWidth</span> = <span class="number">1</span>+i;</span><br><span class="line">    ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">    ctx.<span class="title function_">moveTo</span>(<span class="number">5</span>+i*<span class="number">14</span>,<span class="number">5</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">5</span>+i*<span class="number">14</span>,<span class="number">140</span>);</span><br><span class="line">    ctx.<span class="title function_">stroke</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>想要获得精确的线条，必须对线条是如何描绘出来的有所理解。见下图，用网格来代表 canvas 的坐标格，每一格对应屏幕上一个像素点。在第一个图中，填充了 (2,1) 至 (5,5)  的矩形，整个区域的边界刚好落在像素边缘上，这样就可以得到的矩形有着清晰的边缘。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667122831821-f281e51b-8d1d-4a15-ae4b-3c79a4361e28.png" alt="img"></p>
<p>如果你想要绘制一条从 (3,1) 到 (3,5)，宽度是 1.0  的线条，你会得到像第二幅图一样的结果。实际填充区域（深蓝色部分）仅仅延伸至路径两旁各一半像素。而这半个像素又会以近似的方式进行渲染，这意味着那些像素只是部分着色，结果就是以实际笔触颜色一半色调的颜色来填充整个区域（浅蓝和深蓝的部分）。这就是上例中为何宽度为 1.0 的线并不准确的原因。</p>
<p>要解决这个问题，你必须对路径施以更加精确的控制。已知粗 1.0 的线条会在路径两边各延伸半像素，那么像第三幅图那样绘制从 (3.5,1) 到 (3.5,5) 的线条，其边缘正好落在像素边界，填充出来就是准确的宽为 1.0 的线条。</p>
<p><strong>备注：</strong> 在这个竖线的例子中，其 Y 坐标刚好落在网格线上，否则端点上同样会出现半渲染的像素点（但还要注意，这种行为的表现取决于当前的 lineCap  风格，它默认为 butt；您可能希望通过将 lineCap 样式设置为 square  正方形，来得到与奇数宽度线的半像素坐标相一致的笔画，这样，端点轮廓的外边框将被自动扩展以完全覆盖整个像素格）。</p>
<p>还请注意，只有路径的起点和终点受此影响：如果一个路径是通过 closePath() 来封闭的，它是没有起点和终点的；相反的情况下，路径上的所有端点都与上一个点相连，下一段路径使用当前的 lineJoin 设置（默认为  miter），如果相连路径是水平和/或垂直的话，会导致相连路径的外轮廓根据相交点自动延伸，因此渲染出的路径轮廓会覆盖整个像素格。接下来的两个小节将展示这些额外的行样式。</p>
<p>对于那些宽度为偶数的线条，每一边的像素数都是整数，那么你想要其路径是落在像素点之间 (如那从 (3,1) 到 (3,5)) 而不是在像素点的中间。同样，注意到那个例子的垂直线条，其 Y 坐标刚好落在网格线上，如果不是的话，端点上同样会出现半渲染的像素点。</p>
<p>虽然开始处理可缩放的 2D 图形时会有点小痛苦，但是及早注意到像素网格与路径位置之间的关系，可以确保图形在经过缩放或者其它任何变形后都可以保持看上去蛮好：线宽为 1.0 的垂线在放大 2 倍后，会变成清晰的线宽为 2.0，并且出现在它应该出现的位置上。</p>
<h4 id="-27"><a href="#-27" class="headerlink" title=" "></a> </h4><h4 id="lineCap-属性的例子"><a href="#lineCap-属性的例子" class="headerlink" title="lineCap 属性的例子"></a>lineCap 属性的例子</h4><p>属性 lineCap 的值决定了线段端点显示的样子。它可以为下面的三种的其中之一：butt，round 和 square。默认是 butt。</p>
<p>在这个例子里面，我绘制了三条直线，分别赋予不同的 lineCap 值。还有两条辅助线，为了可以看得更清楚它们之间的区别，三条线的起点终点都落在辅助线上。</p>
<p>最左边的线用了默认的 butt 。可以注意到它是与辅助线齐平的。中间的是 round 的效果，端点处加上了半径为一半线宽的半圆。右边的是 square 的效果，端点处加上了等宽且高度为一半线宽的方块。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> lineCap = [<span class="string">&#x27;butt&#x27;</span>,<span class="string">&#x27;round&#x27;</span>,<span class="string">&#x27;square&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建路径</span></span><br><span class="line">  ctx.<span class="property">strokeStyle</span> = <span class="string">&#x27;#09f&#x27;</span>;</span><br><span class="line">  ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">  ctx.<span class="title function_">moveTo</span>(<span class="number">10</span>,<span class="number">10</span>);</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(<span class="number">140</span>,<span class="number">10</span>);</span><br><span class="line">  ctx.<span class="title function_">moveTo</span>(<span class="number">10</span>,<span class="number">140</span>);</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(<span class="number">140</span>,<span class="number">140</span>);</span><br><span class="line">  ctx.<span class="title function_">stroke</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 画线条</span></span><br><span class="line">  ctx.<span class="property">strokeStyle</span> = <span class="string">&#x27;black&#x27;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;lineCap.<span class="property">length</span>;i++)&#123;</span><br><span class="line">    ctx.<span class="property">lineWidth</span> = <span class="number">15</span>;</span><br><span class="line">    ctx.<span class="property">lineCap</span> = lineCap[i];</span><br><span class="line">    ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">    ctx.<span class="title function_">moveTo</span>(<span class="number">25</span>+i*<span class="number">50</span>,<span class="number">10</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">25</span>+i*<span class="number">50</span>,<span class="number">140</span>);</span><br><span class="line">    ctx.<span class="title function_">stroke</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667122878490-b77352b0-f09d-4fbd-bfe8-f484d398dc37.png" alt="img"></p>
<h4 id="-28"><a href="#-28" class="headerlink" title=" "></a> </h4><h4 id="lineJoin-属性的例子"><a href="#lineJoin-属性的例子" class="headerlink" title="lineJoin 属性的例子"></a>lineJoin 属性的例子</h4><p>lineJoin 的属性值决定了图形中两线段连接处所显示的样子。它可以是这三种之一：round, bevel 和 miter。默认是 miter。</p>
<p>这里我同样用三条折线来做例子，分别设置不同的 lineJoin 值。最上面一条是 round 的效果，边角处被磨圆了，圆的半径等于线宽。中间和最下面一条分别是 bevel 和 miter  的效果。当值是 miter 的时候，线段会在连接处外侧延伸直至交于一点，延伸效果受到下面将要介绍的 miterLimit 属性的制约。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> lineJoin = [<span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;bevel&#x27;</span>, <span class="string">&#x27;miter&#x27;</span>];</span><br><span class="line">  ctx.<span class="property">lineWidth</span> = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; lineJoin.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    ctx.<span class="property">lineJoin</span> = lineJoin[i];</span><br><span class="line">    ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">    ctx.<span class="title function_">moveTo</span>(-<span class="number">5</span>, <span class="number">5</span> + i * <span class="number">40</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">35</span>, <span class="number">45</span> + i * <span class="number">40</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">75</span>, <span class="number">5</span> + i * <span class="number">40</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">115</span>, <span class="number">45</span> + i * <span class="number">40</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">155</span>, <span class="number">5</span> + i * <span class="number">40</span>);</span><br><span class="line">    ctx.<span class="title function_">stroke</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667122903925-6f71a245-1bda-42fa-aebe-e89231b401fd.png" alt="img"></p>
<h4 id="-29"><a href="#-29" class="headerlink" title=" "></a> </h4><h4 id="miterLimit-属性的演示例子"><a href="#miterLimit-属性的演示例子" class="headerlink" title="miterLimit 属性的演示例子"></a>miterLimit 属性的演示例子</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667192776029-37cc94ac-d0b6-4fd1-b771-e164cb2ad533.png" alt="img"></p>
<p>就如上一个例子所见的应用 miter 的效果，线段的外侧边缘会被延伸交汇于一点上。线段之间夹角比较大时，交点不会太远，但随着夹角变小，交点距离会呈指数级增大。</p>
<p>miterLimit 属性就是用来设定外延交点与连接点的最大距离，如果交点距离大于此值，连接效果会变成了  bevel。注意，最大斜接长度（即交点距离）是当前坐标系测量线宽与此miterLimit属性值（HTML canvas默认为  10.0）的乘积，所以miterLimit可以单独设置，不受显示比例改变或任何仿射变换的影响：它只影响线条边缘的有效绘制形状。</p>
<p>更准确的说，斜接限定值（miterLimit）是延伸长度（在 HTML Canvas  中，这个值是线段外连接点与路径中指定的点之间的距离）与一半线宽的最大允许比值。它也可以被等效定义为线条内外连接点距离（miterLength）与线宽（lineWidth）的最大允许比值（因为路径点是内外连接点的中点）。这等同于相交线段最小内夹角（<em>θ</em>）的一半的余割值，小于此角度的斜接将不会被渲染，而仅渲染斜边连接：</p>
<ul>
<li>miterLimit = <strong>max</strong> miterLength / lineWidth = 1 / <strong>sin</strong> ( <strong>min</strong> <em>θ</em> / 2 )</li>
<li>斜接限定值默认为 10.0，这将会去除所有小于大约 11 度的斜接。</li>
<li>斜接限定值为 √2 ≈ 1.4142136（四舍五入）时，将去除所有锐角的斜接，仅保留钝角或直角。</li>
<li>1.0 是合法的斜接限定值，但这会去除所有斜接。</li>
<li>小于 1.0 的值不是合法的斜接限定值。</li>
</ul>
<p>在下面的小示例中，您可以动态的设置miterLimit的值并查看它对画布中图形的影响。蓝色线条指出了锯齿图案中每个线条的起点与终点（同时也是不同线段之间的连接点）。</p>
<p>在此示例中，当您设定miterLimit的值小于 4.2 时，图形可见部分的边角不会延伸相交，而是在蓝色线条边呈现斜边连接效果；当miterLimit的值大于 10.0  时，此例中大部分的边角都会在远离蓝线的位置相交，且从左至右，距离随着夹角的增大而减小；而介于上述值之间的值所呈现的效果，也介于两者之间。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 清空画布</span></span><br><span class="line">  ctx.<span class="title function_">clearRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">150</span>, <span class="number">150</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 绘制参考线</span></span><br><span class="line">  ctx.<span class="property">strokeStyle</span> = <span class="string">&#x27;#09f&#x27;</span>;</span><br><span class="line">  ctx.<span class="property">lineWidth</span>   = <span class="number">2</span>;</span><br><span class="line">  ctx.<span class="title function_">strokeRect</span>(-<span class="number">5</span>, <span class="number">50</span>, <span class="number">160</span>, <span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置线条样式</span></span><br><span class="line">  ctx.<span class="property">strokeStyle</span> = <span class="string">&#x27;#000&#x27;</span>;</span><br><span class="line">  ctx.<span class="property">lineWidth</span> = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 检查输入</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;miterLimit&#x27;</span>).<span class="property">value</span>.<span class="title function_">match</span>(<span class="regexp">/\d+(\.\d+)?/</span>)) &#123;</span><br><span class="line">    ctx.<span class="property">miterLimit</span> = <span class="built_in">parseFloat</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;miterLimit&#x27;</span>).<span class="property">value</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;Value must be a positive number&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 绘制线条</span></span><br><span class="line">  ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">  ctx.<span class="title function_">moveTo</span>(<span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">24</span> ; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> dy = i % <span class="number">2</span> == <span class="number">0</span> ? <span class="number">25</span> : -<span class="number">25</span>;</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="title class_">Math</span>.<span class="title function_">pow</span>(i, <span class="number">1.5</span>) * <span class="number">2</span>, <span class="number">75</span> + dy);</span><br><span class="line">  &#125;</span><br><span class="line">  ctx.<span class="title function_">stroke</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667122934008-8d3b6d21-d2f8-4f14-8524-b924eac4cbc4.png" alt="img"></p>
<h2 id="-30"><a href="#-30" class="headerlink" title=" "></a> </h2><h2 id="使用虚线"><a href="#使用虚线" class="headerlink" title="使用虚线"></a>使用虚线</h2><p>用 setLineDash 方法和 lineDashOffset 属性来制定虚线样式。setLineDash 方法接受一个数组，来指定线段与间隙的交替；lineDashOffset 属性设置起始偏移量。</p>
<p>在这个例子中，我们要创建一个蚂蚁线的效果。它往往应用在计算机图形程序选区工具动效中。它可以帮助用户通过动画的边界来区分图像背景选区边框。在本教程的后面部分，你可以学习如何实现这一点和其他基本的动画。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> offset = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  ctx.<span class="title function_">clearRect</span>(<span class="number">0</span>,<span class="number">0</span>, canvas.<span class="property">width</span>, canvas.<span class="property">height</span>);</span><br><span class="line">  ctx.<span class="title function_">setLineDash</span>([<span class="number">4</span>, <span class="number">2</span>]);</span><br><span class="line">  ctx.<span class="property">lineDashOffset</span> = -offset;</span><br><span class="line">  ctx.<span class="title function_">strokeRect</span>(<span class="number">10</span>,<span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">march</span>(<span class="params"></span>) &#123;</span><br><span class="line">  offset++;</span><br><span class="line">  <span class="keyword">if</span> (offset &gt; <span class="number">16</span>) &#123;</span><br><span class="line">    offset = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">draw</span>();</span><br><span class="line">  <span class="built_in">setTimeout</span>(march, <span class="number">20</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">march</span>();</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667122956661-62d2ca82-a024-4450-8b17-a576295960c0.png" alt="img"></p>
<h2 id="-31"><a href="#-31" class="headerlink" title=" "></a> </h2><h2 id="渐变-Gradients"><a href="#渐变-Gradients" class="headerlink" title="渐变 Gradients"></a>渐变 Gradients</h2><p>就好像一般的绘图软件一样，我们可以用线性或者径向的渐变来填充或描边。我们用下面的方法新建一个 canvasGradient 对象，并且赋给图形的 fillStyle 或 strokeStyle 属性。</p>
<p>createLinearGradient(x1, y1, x2, y2)</p>
<p>createLinearGradient 方法接受 4 个参数，表示渐变的起点 (x1,y1) 与终点 (x2,y2)。</p>
<p>createRadialGradient(x1, y1, r1, x2, y2, r2)</p>
<p>createRadialGradient 方法接受 6 个参数，前三个定义一个以 (x1,y1) 为原点，半径为 r1 的圆，后三个参数则定义另一个以 (x2,y2) 为原点，半径为 r2 的圆。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lineargradient = ctx.<span class="title function_">createLinearGradient</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">150</span>,<span class="number">150</span>);</span><br><span class="line"><span class="keyword">var</span> radialgradient = ctx.<span class="title function_">createRadialGradient</span>(<span class="number">75</span>,<span class="number">75</span>,<span class="number">0</span>,<span class="number">75</span>,<span class="number">75</span>,<span class="number">100</span>);</span><br></pre></td></tr></table></figure>
<p>创建出 canvasGradient 对象后，我们就可以用 addColorStop 方法给它上色了。</p>
<p>gradient.addColorStop(position, color)</p>
<p>addColorStop 方法接受 2 个参数，position 参数必须是一个 0.0 与 1.0 之间的数值，表示渐变中颜色所在的相对位置。例如，0.5  表示颜色会出现在正中间。color 参数必须是一个有效的 CSS 颜色值（如 #FFF，rgba(0,0,0,1)，等等）。</p>
<p>你可以根据需要添加任意多个色标（color stops）。下面是最简单的线性黑白渐变的例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lineargradient = ctx.<span class="title function_">createLinearGradient</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">150</span>,<span class="number">150</span>);</span><br><span class="line">lineargradient.<span class="title function_">addColorStop</span>(<span class="number">0</span>,<span class="string">&#x27;white&#x27;</span>);</span><br><span class="line">lineargradient.<span class="title function_">addColorStop</span>(<span class="number">1</span>,<span class="string">&#x27;black&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h4 id="createLinearGradient-的例子"><a href="#createLinearGradient-的例子" class="headerlink" title="createLinearGradient 的例子"></a>createLinearGradient 的例子</h4><p>本例中，我弄了两种不同的渐变。第一种是背景色渐变，你会发现，我给同一位置设置了两种颜色，你也可以用这来实现突变的效果，就像这里从白色到绿色的突变。一般情况下，色标的定义是无所谓顺序的，但是色标位置重复时，顺序就变得非常重要了。所以，保持色标定义顺序和它理想的顺序一致，结果应该没什么大问题。</p>
<p>第二种渐变，我并不是从 0.0 位置开始定义色标，因为那并不是那么严格的。在 0.5 处设一黑色色标，渐变会默认认为从起点到色标之间都是黑色。</p>
<p>你会发现，strokeStyle 和 fillStyle 属性都可以接受 canvasGradient 对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create gradients</span></span><br><span class="line">  <span class="keyword">var</span> lingrad = ctx.<span class="title function_">createLinearGradient</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">150</span>);</span><br><span class="line">  lingrad.<span class="title function_">addColorStop</span>(<span class="number">0</span>, <span class="string">&#x27;#00ABEB&#x27;</span>);</span><br><span class="line">  lingrad.<span class="title function_">addColorStop</span>(<span class="number">0.5</span>, <span class="string">&#x27;#fff&#x27;</span>);</span><br><span class="line">  lingrad.<span class="title function_">addColorStop</span>(<span class="number">0.5</span>, <span class="string">&#x27;#26C000&#x27;</span>);</span><br><span class="line">  lingrad.<span class="title function_">addColorStop</span>(<span class="number">1</span>, <span class="string">&#x27;#fff&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> lingrad2 = ctx.<span class="title function_">createLinearGradient</span>(<span class="number">0</span>,<span class="number">50</span>,<span class="number">0</span>,<span class="number">95</span>);</span><br><span class="line">  lingrad2.<span class="title function_">addColorStop</span>(<span class="number">0.5</span>, <span class="string">&#x27;#000&#x27;</span>);</span><br><span class="line">  lingrad2.<span class="title function_">addColorStop</span>(<span class="number">1</span>, <span class="string">&#x27;rgba(0,0,0,0)&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// assign gradients to fill and stroke styles</span></span><br><span class="line">  ctx.<span class="property">fillStyle</span> = lingrad;</span><br><span class="line">  ctx.<span class="property">strokeStyle</span> = lingrad2;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// draw shapes</span></span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">10</span>,<span class="number">10</span>,<span class="number">130</span>,<span class="number">130</span>);</span><br><span class="line">  ctx.<span class="title function_">strokeRect</span>(<span class="number">50</span>,<span class="number">50</span>,<span class="number">50</span>,<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667123028886-37cfbbb6-319d-42f1-a084-c8c5019328ff.png" alt="img"></p>
<h3 id="-32"><a href="#-32" class="headerlink" title=" "></a> </h3><h3 id="createRadialGradient的例子"><a href="#createRadialGradient的例子" class="headerlink" title="createRadialGradient的例子"></a>createRadialGradient的例子</h3><p>这个例子，我定义了 4 个不同的径向渐变。由于可以控制渐变的起始与结束点，所以我们可以实现一些比（如在 Photoshop 中所见的）经典的径向渐变更为复杂的效果。（经典的径向渐变是只有一个中心点，简单地由中心点向外围的圆形扩张）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建渐变</span></span><br><span class="line">  <span class="keyword">var</span> radgrad = ctx.<span class="title function_">createRadialGradient</span>(<span class="number">45</span>,<span class="number">45</span>,<span class="number">10</span>,<span class="number">52</span>,<span class="number">50</span>,<span class="number">30</span>);</span><br><span class="line">  radgrad.<span class="title function_">addColorStop</span>(<span class="number">0</span>, <span class="string">&#x27;#A7D30C&#x27;</span>);</span><br><span class="line">  radgrad.<span class="title function_">addColorStop</span>(<span class="number">0.9</span>, <span class="string">&#x27;#019F62&#x27;</span>);</span><br><span class="line">  radgrad.<span class="title function_">addColorStop</span>(<span class="number">1</span>, <span class="string">&#x27;rgba(1,159,98,0)&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> radgrad2 = ctx.<span class="title function_">createRadialGradient</span>(<span class="number">105</span>,<span class="number">105</span>,<span class="number">20</span>,<span class="number">112</span>,<span class="number">120</span>,<span class="number">50</span>);</span><br><span class="line">  radgrad2.<span class="title function_">addColorStop</span>(<span class="number">0</span>, <span class="string">&#x27;#FF5F98&#x27;</span>);</span><br><span class="line">  radgrad2.<span class="title function_">addColorStop</span>(<span class="number">0.75</span>, <span class="string">&#x27;#FF0188&#x27;</span>);</span><br><span class="line">  radgrad2.<span class="title function_">addColorStop</span>(<span class="number">1</span>, <span class="string">&#x27;rgba(255,1,136,0)&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> radgrad3 = ctx.<span class="title function_">createRadialGradient</span>(<span class="number">95</span>,<span class="number">15</span>,<span class="number">15</span>,<span class="number">102</span>,<span class="number">20</span>,<span class="number">40</span>);</span><br><span class="line">  radgrad3.<span class="title function_">addColorStop</span>(<span class="number">0</span>, <span class="string">&#x27;#00C9FF&#x27;</span>);</span><br><span class="line">  radgrad3.<span class="title function_">addColorStop</span>(<span class="number">0.8</span>, <span class="string">&#x27;#00B5E2&#x27;</span>);</span><br><span class="line">  radgrad3.<span class="title function_">addColorStop</span>(<span class="number">1</span>, <span class="string">&#x27;rgba(0,201,255,0)&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> radgrad4 = ctx.<span class="title function_">createRadialGradient</span>(<span class="number">0</span>,<span class="number">150</span>,<span class="number">50</span>,<span class="number">0</span>,<span class="number">140</span>,<span class="number">90</span>);</span><br><span class="line">  radgrad4.<span class="title function_">addColorStop</span>(<span class="number">0</span>, <span class="string">&#x27;#F4F201&#x27;</span>);</span><br><span class="line">  radgrad4.<span class="title function_">addColorStop</span>(<span class="number">0.8</span>, <span class="string">&#x27;#E4C700&#x27;</span>);</span><br><span class="line">  radgrad4.<span class="title function_">addColorStop</span>(<span class="number">1</span>, <span class="string">&#x27;rgba(228,199,0,0)&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 画图形</span></span><br><span class="line">  ctx.<span class="property">fillStyle</span> = radgrad4;</span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">150</span>,<span class="number">150</span>);</span><br><span class="line">  ctx.<span class="property">fillStyle</span> = radgrad3;</span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">150</span>,<span class="number">150</span>);</span><br><span class="line">  ctx.<span class="property">fillStyle</span> = radgrad2;</span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">150</span>,<span class="number">150</span>);</span><br><span class="line">  ctx.<span class="property">fillStyle</span> = radgrad;</span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">150</span>,<span class="number">150</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里，我让起点稍微偏离终点，这样可以达到一种球状 3D 效果。但最好不要让里圆与外圆部分交叠，那样会产生什么效果就真是不得而知了。</p>
<p>4 个径向渐变效果的最后一个色标都是透明色。如果想要两色标直接的过渡柔和一些，只要两个颜色值一致就可以了。代码里面看不出来，是因为我用了两种不同的颜色表示方法，但其实是相同的，#019F62 = rgba(1,159,98,1)。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667123057094-ac7a9bb7-5e32-4df5-a591-c73b4ca5ce53.png" alt="img"></p>
<h2 id="-33"><a href="#-33" class="headerlink" title=" "></a> </h2><h2 id="图案样式-Patterns"><a href="#图案样式-Patterns" class="headerlink" title="图案样式 Patterns"></a>图案样式 Patterns</h2><p>上一节的一个例子里面，我用了循环来实现图案的效果。其实，有一个更加简单的方法：createPattern。</p>
<p>createPattern(image, type)</p>
<p>该方法接受两个参数。Image 可以是一个 Image 对象的引用，或者另一个 canvas 对象。Type 必须是下面的字符串值之一：repeat，repeat-x，repeat-y 和 no-repeat。</p>
<p><strong>备注：</strong> 用 canvas 对象作为 Image 参数在 Firefox 1.5 (Gecko 1.8) 中是无效的。</p>
<p>图案的应用跟渐变很类似的，创建出一个 pattern 之后，赋给 fillStyle 或 strokeStyle 属性即可。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">img.<span class="property">src</span> = <span class="string">&#x27;someimage.png&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> ptrn = ctx.<span class="title function_">createPattern</span>(img,<span class="string">&#x27;repeat&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><strong>备注：</strong> 与 drawImage 有点不同，你需要确认 image 对象已经装载完毕，否则图案可能效果不对的。</p>
<h3 id="-34"><a href="#-34" class="headerlink" title=" "></a> </h3><h3 id="createPattern的例子"><a href="#createPattern的例子" class="headerlink" title="createPattern的例子"></a>createPattern的例子</h3><p>在最后的例子中，我创建一个图案然后赋给了 fillStyle 属性。唯一要注意的是，使用 Image 对象的 onload handler 来确保设置图案之前图像已经装载完毕。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建新 image 对象，用作图案</span></span><br><span class="line">  <span class="keyword">var</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">  img.<span class="property">src</span> = <span class="string">&#x27;https://mdn.mozillademos.org/files/222/Canvas_createpattern.png&#x27;</span>;</span><br><span class="line">  img.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建图案</span></span><br><span class="line">    <span class="keyword">var</span> ptrn = ctx.<span class="title function_">createPattern</span>(img, <span class="string">&#x27;repeat&#x27;</span>);</span><br><span class="line">    ctx.<span class="property">fillStyle</span> = ptrn;</span><br><span class="line">    ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">150</span>, <span class="number">150</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="阴影-Shadows"><a href="#阴影-Shadows" class="headerlink" title="阴影 Shadows"></a>阴影 Shadows</h2><p>shadowOffsetX = float</p>
<p>shadowOffsetX 和 shadowOffsetY 用来设定阴影在 X 和 Y 轴的延伸距离，它们是不受变换矩阵所影响的。负值表示阴影会往上或左延伸，正值则表示会往下或右延伸，它们默认都为 0。</p>
<p>shadowOffsetY = float</p>
<p>shadowOffsetX 和 shadowOffsetY 用来设定阴影在 X 和 Y 轴的延伸距离，它们是不受变换矩阵所影响的。负值表示阴影会往上或左延伸，正值则表示会往下或右延伸，它们默认都为 0。</p>
<p>shadowBlur = float</p>
<p>shadowBlur 用于设定阴影的模糊程度，其数值并不跟像素数量挂钩，也不受变换矩阵的影响，默认为 0。</p>
<p>shadowColor = color</p>
<p>shadowColor 是标准的 CSS 颜色值，用于设定阴影颜色效果，默认是全透明的黑色。</p>
<h3 id="-35"><a href="#-35" class="headerlink" title=" "></a> </h3><h3 id="文字阴影的例子"><a href="#文字阴影的例子" class="headerlink" title="文字阴影的例子"></a>文字阴影的例子</h3><p>这个例子绘制了带阴影效果的文字。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  ctx.<span class="property">shadowOffsetX</span> = <span class="number">2</span>;</span><br><span class="line">  ctx.<span class="property">shadowOffsetY</span> = <span class="number">2</span>;</span><br><span class="line">  ctx.<span class="property">shadowBlur</span> = <span class="number">2</span>;</span><br><span class="line">  ctx.<span class="property">shadowColor</span> = <span class="string">&quot;rgba(0, 0, 0, 0.5)&quot;</span>;</span><br><span class="line"></span><br><span class="line">  ctx.<span class="property">font</span> = <span class="string">&quot;20px Times New Roman&quot;</span>;</span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&quot;Black&quot;</span>;</span><br><span class="line">  ctx.<span class="title function_">fillText</span>(<span class="string">&quot;Sample String&quot;</span>, <span class="number">5</span>, <span class="number">30</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667123140725-95bd7bb5-fe21-4d91-b6d9-276c0f0e5900.png" alt="img"></p>
<p>我们可以通过下一章来了解文字属性和 fillText 方法相关的内容。</p>
<h2 id="-36"><a href="#-36" class="headerlink" title=" "></a> </h2><h2 id="Canvas-填充规则"><a href="#Canvas-填充规则" class="headerlink" title="Canvas 填充规则"></a>Canvas 填充规则</h2><p>当我们用到 fill（或者 clip和isPointinPath ）你可以选择一个填充规则，该填充规则根据某处在路径的外面或者里面来决定该处是否被填充，这对于自己与自己路径相交或者路径被嵌套的时候是有用的。</p>
<p>两个可能的值：</p>
<ul>
<li><strong>“nonzero</strong>“: non-zero winding rule, 默认值。</li>
<li><strong>“evenodd”</strong>: even-odd winding rule.</li>
</ul>
<p>这个例子，我们用填充规则 evenodd</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">  ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">  ctx.<span class="title function_">arc</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">30</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>, <span class="literal">true</span>);</span><br><span class="line">  ctx.<span class="title function_">arc</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>, <span class="literal">true</span>);</span><br><span class="line">  ctx.<span class="title function_">fill</span>(<span class="string">&quot;evenodd&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667123175455-39bca738-50b5-4ccc-9f22-ccfa84e4c744.png" alt="img"></p>
<h1 id="03-绘制图像和视频"><a href="#03-绘制图像和视频" class="headerlink" title="03-绘制图像和视频"></a>03-绘制图像和视频</h1><p>canvas  更有意思的一项特性就是图像操作能力。可以用于动态的图像合成或者作为图形的背景，以及游戏界面（Sprites）等等。浏览器支持的任意格式的外部图片都可以使用，比如 PNG、GIF 或者 JPEG。你甚至可以将同一个页面中其他 canvas 元素生成的图片作为图片源。</p>
<p>引入图像到 canvas 里需要以下两步基本操作：</p>
<ol>
<li>获得一个指向HTMLImageElement的对象或者另一个 canvas 元素的引用作为源，也可以通过提供一个 URL 的方式来使用图片</li>
<li>使用drawImage()函数将图片绘制到画布上</li>
</ol>
<p>我们来看看具体是怎么做的。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667223627890-1c5888f5-6ce5-49ee-b09c-c3734aca9de0.png" alt="img"></p>
<h2 id="-37"><a href="#-37" class="headerlink" title=" "></a> </h2><h2 id="获得需要绘制的图片"><a href="#获得需要绘制的图片" class="headerlink" title="获得需要绘制的图片"></a>获得需要绘制的图片</h2><p>canvas 的 API 可以使用下面这些类型中的一种作为图片的源：</p>
<p>HTMLImageElement</p>
<p>这些图片是由 Image() 函数构造出来的，或者任何的 img 元素</p>
<p>HTMLVideoElement</p>
<p>用一个 HTML 的 video元素作为你的图片源，可以从视频中抓取当前帧作为一个图像</p>
<p>HTMLCanvasElement</p>
<p>可以使用另一个 canvas 元素作为你的图片源。</p>
<p>ImageBitmap</p>
<p>这是一个高性能的位图，可以低延迟地绘制，它可以从上述的所有源以及其它几种源中生成。</p>
<h3 id="-38"><a href="#-38" class="headerlink" title=" "></a> </h3><h3 id="例子：一个简单的线图"><a href="#例子：一个简单的线图" class="headerlink" title="例子：一个简单的线图"></a>例子：一个简单的线图</h3><p>下面一个例子我用一个外部图像作为一线性图的背景。用背景图我们就不需要绘制复杂的背景，省下不少代码。这里只用到一个 image 对象，于是就在它的 onload 事件响应函数中触发绘制动作。drawImage 方法将背景图放置在 canvas 的左上角  (0,0) 处。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">  img.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    ctx.<span class="title function_">drawImage</span>(img,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">    ctx.<span class="title function_">moveTo</span>(<span class="number">30</span>,<span class="number">96</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">70</span>,<span class="number">66</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">103</span>,<span class="number">76</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">170</span>,<span class="number">15</span>);</span><br><span class="line">    ctx.<span class="title function_">stroke</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  img.<span class="property">src</span> = <span class="string">&#x27;https://mdn.mozillademos.org/files/5395/backdrop.png&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="缩放-Scaling"><a href="#缩放-Scaling" class="headerlink" title="缩放 Scaling"></a>缩放 Scaling</h2><p>drawImage 方法的又一变种是增加了两个用于控制图像在 canvas 中缩放的参数。</p>
<p>drawImage(image, x, y, width, height)</p>
<p>这个方法多了 2 个参数：width 和 height，这两个参数用来控制 当向 canvas 画入时应该缩放的大小</p>
<h3 id="-39"><a href="#-39" class="headerlink" title=" "></a> </h3><h3 id="例子：平铺图像"><a href="#例子：平铺图像" class="headerlink" title="例子：平铺图像"></a>例子：平铺图像</h3><p>在这个例子里，我会用一张图片像背景一样在 canvas 中以重复平铺开来。实现起来也很简单，只需要循环铺开经过缩放的图片即可。见下面的代码，第一层 for  循环是做行重复，第二层是做列重复的。图像大小被缩放至原来的三分之一，50x38  px。这种方法可以用来很好的达到背景图案的效果，在下面的教程中会看到。</p>
<p><strong>备注：</strong> 图像可能会因为大幅度的缩放而变得起杂点或者模糊。如果您的图像里面有文字，那么最好还是不要进行缩放，因为那样处理之后很可能图像里的文字就会变得无法辨认了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">  img.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;<span class="number">3</span>;j++)&#123;</span><br><span class="line">        ctx.<span class="title function_">drawImage</span>(img,j*<span class="number">50</span>,i*<span class="number">38</span>,<span class="number">50</span>,<span class="number">38</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  img.<span class="property">src</span> = <span class="string">&#x27;https://mdn.mozillademos.org/files/5397/rhino.jpg&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="切片-Slicing"><a href="#切片-Slicing" class="headerlink" title="切片 Slicing"></a>切片 Slicing</h2><p>drawImage 方法的第三个也是最后一个变种有 8 个新参数，用于控制做切片显示的。</p>
<p>drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight)</p>
<p>第一个参数和其它的是相同的，都是一个图像或者另一个 canvas 的引用。其它 8 个参数最好是参照右边的图解，前 4 个是定义图像源的切片位置和大小，后 4 个则是定义切片的目标显示位置和大小。</p>
<p>切片是个做图像合成的强大工具。假设有一张包含了所有元素的图像，那么你可以用这个方法来合成一个完整图像。例如，你想画一张图表，而手上有一个包含所有必需的文字的 PNG 文件，那么你可以很轻易的根据实际数据的需要来改变最终显示的图表。这方法的另一个好处就是你不需要单独装载每一个图像。</p>
<h3 id="-40"><a href="#-40" class="headerlink" title=" "></a> </h3><h3 id="例子：相框"><a href="#例子：相框" class="headerlink" title="例子：相框"></a>例子：相框</h3><p>在这个例子里面我用到上面已经用过的犀牛图像，不过这次我要给犀牛头做个切片特写，然后合成到一个相框里面去。相框带有阴影效果，是一个以 24-bit PNG 格式保存的图像。因为 24-bit PNG 图像带有一个完整的 8-bit alpha 通道，与 GIF 和 8-bit PNG 不同，我可以将它放成背景而不必担心底色的问题。</p>
<p>我用一个与上面用到的不同的方法来装载图像，直接将图像插入到 HTML  里面，然后通过 CSS 隐藏（display:none）它。两个图像我都赋了 id  ，方便后面使用。看下面的脚本，相当简单，首先对犀牛头做好切片（第一次drawImage）放在 canvas  上，然后再上面套个相框（第二次drawImage）。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">&quot;draw();&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas&quot;</span> <span class="attr">width</span>=<span class="string">&quot;150&quot;</span> <span class="attr">height</span>=<span class="string">&quot;150&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;display:none;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;source&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://mdn.mozillademos.org/files/5397/rhino.jpg&quot;</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">height</span>=<span class="string">&quot;227&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;frame&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://mdn.mozillademos.org/files/242/Canvas_picture_frame.png&quot;</span> <span class="attr">width</span>=<span class="string">&quot;132&quot;</span> <span class="attr">height</span>=<span class="string">&quot;150&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">function draw() &#123;</span><br><span class="line">  var canvas = document.getElementById(&#x27;canvas&#x27;);</span><br><span class="line">  var ctx = canvas.getContext(&#x27;2d&#x27;);</span><br><span class="line"></span><br><span class="line">  // Draw slice</span><br><span class="line">  ctx.drawImage(document.getElementById(&#x27;source&#x27;),</span><br><span class="line">                33,71,104,124,21,20,87,104);</span><br><span class="line"></span><br><span class="line">  // Draw frame</span><br><span class="line">  ctx.drawImage(document.getElementById(&#x27;frame&#x27;),0,0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="示例：画廊-Art-gallery-example"><a href="#示例：画廊-Art-gallery-example" class="headerlink" title="示例：画廊 Art gallery example"></a>示例：画廊 Art gallery example</h2><p>我这一章最后的示例是弄一个小画廊。画廊由挂着几张画作的格子组成。当页面装载好之后，为每张画创建一个 canvas 元素并用加上画框然后插入到画廊中去。</p>
<p>在我这个例子里面，所有“画”都是固定宽高的，画框也是。你可以做些改进，通过脚本用画的宽高来准确控制围绕它的画框的大小。</p>
<p>下面的代码应该是蛮简单易懂的了。就是遍历图像对象数组，依次创建新的 canvas 元素并添加进去。可能唯一需要注意的，对于那些并不熟悉 DOM 的朋友来说，是 insertBefore  方法的用法。insertBefore 是父节点（单元格）的方法，用于将新节点（canvas 元素）插入到我们想要插入的节点之前。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">&quot;draw();&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://mdn.mozillademos.org/files/5399/gallery_1.jpg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://mdn.mozillademos.org/files/5401/gallery_2.jpg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://mdn.mozillademos.org/files/5403/gallery_3.jpg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://mdn.mozillademos.org/files/5405/gallery_4.jpg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://mdn.mozillademos.org/files/5407/gallery_5.jpg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://mdn.mozillademos.org/files/5409/gallery_6.jpg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://mdn.mozillademos.org/files/5411/gallery_7.jpg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://mdn.mozillademos.org/files/5413/gallery_8.jpg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;frame&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://mdn.mozillademos.org/files/242/Canvas_picture_frame.png&quot;</span> <span class="attr">width</span>=<span class="string">&quot;132&quot;</span> <span class="attr">height</span>=<span class="string">&quot;150&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">body &#123;</span><br><span class="line">  background: 0 -100px repeat-x url(https://mdn.mozillademos.org/files/5415/bg_gallery.png) #4F191A;</span><br><span class="line">  margin: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">img &#123;</span><br><span class="line">  display: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">table &#123;</span><br><span class="line">  margin: 0 auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">td &#123;</span><br><span class="line">  padding: 15px;</span><br><span class="line">&#125;</span><br><span class="line">function draw() &#123;</span><br><span class="line"></span><br><span class="line">  // Loop through all images</span><br><span class="line">  for (i=0;i&lt;document.images.length;i++)&#123;</span><br><span class="line"></span><br><span class="line">    // Don&#x27;t add a canvas for the frame image</span><br><span class="line">    if (document.images[i].getAttribute(&#x27;id&#x27;)!=&#x27;frame&#x27;)&#123;</span><br><span class="line"></span><br><span class="line">      // Create canvas element</span><br><span class="line">      canvas = document.createElement(&#x27;CANVAS&#x27;);</span><br><span class="line">      canvas.setAttribute(&#x27;width&#x27;,132);</span><br><span class="line">      canvas.setAttribute(&#x27;height&#x27;,150);</span><br><span class="line"></span><br><span class="line">      // Insert before the image</span><br><span class="line">      document.images[i].parentNode.insertBefore(canvas,document.images[i]);</span><br><span class="line"></span><br><span class="line">      ctx = canvas.getContext(&#x27;2d&#x27;);</span><br><span class="line"></span><br><span class="line">      // Draw image to canvas</span><br><span class="line">      ctx.drawImage(document.images[i],15,20);</span><br><span class="line"></span><br><span class="line">      // Add frame</span><br><span class="line">      ctx.drawImage(document.getElementById(&#x27;frame&#x27;),0,0);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="控制图像的缩放行为-Controlling-image-scaling-behavior"><a href="#控制图像的缩放行为-Controlling-image-scaling-behavior" class="headerlink" title="控制图像的缩放行为 Controlling image scaling behavior"></a>控制图像的缩放行为 Controlling image scaling behavior</h2><p>如同前文所述，过度缩放图像可能会导致图像模糊或像素化。您可以通过使用绘图环境的imageSmoothingEnabled属性来控制是否在缩放图像时使用平滑算法。默认值为true，即启用平滑缩放。您也可以像这样禁用此功能：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="property">mozImageSmoothingEnabled</span> = <span class="literal">false</span>;</span><br><span class="line">ctx.<span class="property">webkitImageSmoothingEnabled</span> = <span class="literal">false</span>;</span><br><span class="line">ctx.<span class="property">msImageSmoothingEnabled</span> = <span class="literal">false</span>;</span><br><span class="line">ctx.<span class="property">imageSmoothingEnabled</span> = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>
<h1 id="04-绘制文字"><a href="#04-绘制文字" class="headerlink" title="04-绘制文字"></a>04-绘制文字</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1668398881094-5a483c57-8a7a-4db3-93c1-f140ecbf4a00.gif" alt="img"></p>
<h2 id="-41"><a href="#-41" class="headerlink" title=" "></a> </h2><h2 id="绘制文本"><a href="#绘制文本" class="headerlink" title="绘制文本"></a>绘制文本</h2><p>canvas 提供了两种方法来渲染文本：</p>
<p>fillText(text, x, y [, maxWidth])</p>
<p>在指定的 (x,y) 位置填充指定的文本，绘制的最大宽度是可选的。</p>
<p>strokeText(text, x, y [, maxWidth])</p>
<p>在指定的 (x,y) 位置绘制文本边框，绘制的最大宽度是可选的。</p>
<h3 id="-42"><a href="#-42" class="headerlink" title=" "></a> </h3><h3 id="一个填充文本的示例"><a href="#一个填充文本的示例" class="headerlink" title="一个填充文本的示例"></a>一个填充文本的示例</h3><p>文本用当前的填充方式被填充：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function draw() &#123;</span><br><span class="line">  var ctx = document.getElementById(&#x27;canvas&#x27;).getContext(&#x27;2d&#x27;);</span><br><span class="line">  ctx.font = &quot;48px serif&quot;;</span><br><span class="line">  ctx.fillText(&quot;Hello world&quot;, 10, 50);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667105790357-823d37a9-cd8d-420e-99cd-c86a03368c82.png" alt="img"></p>
<h3 id="-43"><a href="#-43" class="headerlink" title=" "></a> </h3><h3 id="一个文本边框的示例"><a href="#一个文本边框的示例" class="headerlink" title="一个文本边框的示例"></a>一个文本边框的示例</h3><p>文本用当前的边框样式被绘制：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function draw() &#123;</span><br><span class="line">  var ctx = document.getElementById(&#x27;canvas&#x27;).getContext(&#x27;2d&#x27;);</span><br><span class="line">  ctx.font = &quot;48px serif&quot;;</span><br><span class="line">  ctx.strokeText(&quot;Hello world&quot;, 10, 50);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667105810468-4de7261e-5a6e-4f3e-b0aa-46907bc005ea.png" alt="img"></p>
<h2 id="-44"><a href="#-44" class="headerlink" title=" "></a> </h2><h2 id="有样式的文本"><a href="#有样式的文本" class="headerlink" title="有样式的文本"></a>有样式的文本</h2><p>在上面的例子用我们已经使用了 font 来使文本比默认尺寸大一些。还有更多的属性可以让你改变 canvas 显示文本的方式：</p>
<p>font = value</p>
<p>当前我们用来绘制文本的样式。这个字符串使用和 CSS font 属性相同的语法。默认的字体是 10px sans-serif。</p>
<p>textAlign = value</p>
<p>文本对齐选项。可选的值包括：start, end, left, right or center. 默认值是 start。</p>
<p>textBaseline = value</p>
<p>基线对齐选项。可选的值包括：top, hanging, middle, alphabetic, ideographic, bottom。默认值是 alphabetic。</p>
<p>direction = value</p>
<p>文本方向。可能的值包括：ltr, rtl, inherit。默认值是 inherit。</p>
<p>如果你之前使用过 CSS，那么这些选项你会很熟悉。</p>
<p>下面的图片（from the WHATWG）展示了 textBaseline 属性支持的不同的基线情况：</p>
<h3 id="-45"><a href="#-45" class="headerlink" title=" "></a> </h3><h3 id="textBaseline-例子"><a href="#textBaseline-例子" class="headerlink" title="textBaseline 例子"></a>textBaseline 例子</h3><p>编辑下面的代码，看看它们在 canvas 中的变化：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ctx.font = &quot;48px serif&quot;;</span><br><span class="line">ctx.textBaseline = &quot;hanging&quot;;</span><br><span class="line">ctx.strokeText(&quot;Hello world&quot;, 0, 100);</span><br></pre></td></tr></table></figure>
<h2 id="预测量文本宽度"><a href="#预测量文本宽度" class="headerlink" title="预测量文本宽度"></a>预测量文本宽度</h2><p>当你需要获得更多的文本细节时，下面的方法可以给你测量文本的方法。</p>
<p>measureText()</p>
<p>将返回一个 TextMetrics对象的宽度、所在像素，这些体现文本特性的属性。</p>
<p>下面的代码段将展示如何测量文本来获得它的宽度：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function draw() &#123;</span><br><span class="line">  var ctx = document.getElementById(&#x27;canvas&#x27;).getContext(&#x27;2d&#x27;);</span><br><span class="line">  var text = ctx.measureText(&quot;foo&quot;); // TextMetrics object</span><br><span class="line">  text.width; // 16;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="05-变形"><a href="#05-变形" class="headerlink" title="05-变形"></a>05-变形</h1><h3 id="几何变换"><a href="#几何变换" class="headerlink" title="几何变换"></a>几何变换</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1668396482058-84cf0ed9-6b63-4b8d-9dfe-33dd928727d9.png" alt="img"></p>
<p><strong>canvas现在被大量地运用于游戏等动画领域，最主要的归功于它提供的一系列几何变换方法，使得动画更加地容易。所以其几何变换是非常重要的一节。</strong></p>
<p>在本教程前面的部分中，我们已经了解了 Canvas 网格和坐标空间。到目前为止，我们只是根据我们的需要使用默认的网格，改变整个画布的大小。变形是一种更强大的方法，可以将原点移动到另一点、对网格进行旋转和缩放。</p>
<h2 id="-46"><a href="#-46" class="headerlink" title=" "></a> </h2><h2 id="状态的保存和恢复-Saving-and-restoring-state"><a href="#状态的保存和恢复-Saving-and-restoring-state" class="headerlink" title="状态的保存和恢复 Saving and restoring state"></a>状态的保存和恢复 Saving and restoring state</h2><p>在了解变形之前，我先介绍两个在你开始绘制复杂图形时必不可少的方法。</p>
<p>save()</p>
<p>保存画布 (canvas) 的所有状态</p>
<p>restore()</p>
<p>save 和 restore 方法是用来保存和恢复 canvas 状态的，都没有参数。Canvas 的状态就是当前画面应用的所有样式和变形的一个快照。</p>
<p>Canvas 状态存储在栈中，每当save()方法被调用后，当前的状态就被推送到栈中保存。一个绘画状态包括：</p>
<ul>
<li>当前应用的变形（即移动，旋转和缩放，见下）</li>
<li>以及下面这些属性：strokeStyle, fillStyle, globalAlpha, lineWidth, lineCap, lineJoin, miterLimit,  lineDashOffset, shadowOffsetX, shadowOffsetY, shadowBlur, shadowColor,  globalCompositeOperation, font, textAlign, textBaseline, direction,  imageSmoothingEnabled</li>
<li>当前的裁切路径（clipping path），会在下一节介绍</li>
</ul>
<p>你可以调用任意多次 save方法。每一次调用 restore 方法，上一个保存的状态就从栈中弹出，所有设定都恢复。</p>
<h3 id="-47"><a href="#-47" class="headerlink" title=" "></a> </h3><h3 id="save和restore的应用例子"><a href="#save和restore的应用例子" class="headerlink" title="save和restore的应用例子"></a>save和restore的应用例子</h3><p>我们尝试用这个连续矩形的例子来描述 canvas 的状态栈是如何工作的。</p>
<p>第一步是用默认设置画一个大四方形，然后保存一下状态。改变填充颜色画第二个小一点的蓝色四方形，然后再保存一下状态。再次改变填充颜色绘制更小一点的半透明的白色四方形。</p>
<p>到目前为止所做的动作和前面章节的都很类似。不过一旦我们调用 restore，状态栈中最后的状态会弹出，并恢复所有设置。如果不是之前用 save  保存了状态，那么我们就需要手动改变设置来回到前一个状态，这个对于两三个属性的时候还是适用的，一旦多了，我们的代码将会猛涨。</p>
<p>当第二次调用 restore 时，已经恢复到最初的状态，因此最后是再一次绘制出一个黑色的四方形。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667227362304-1dddf3b7-f6c4-42cf-bb8c-88077c268860.png" alt="img"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">150</span>,<span class="number">150</span>);   <span class="comment">// 使用默认设置绘制一个矩形</span></span><br><span class="line">  ctx.<span class="title function_">save</span>();                  <span class="comment">// 保存默认状态</span></span><br><span class="line"></span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;#09F&#x27;</span>       <span class="comment">// 在原有配置基础上对颜色做改变</span></span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">15</span>,<span class="number">15</span>,<span class="number">120</span>,<span class="number">120</span>); <span class="comment">// 使用新的设置绘制一个矩形</span></span><br><span class="line"></span><br><span class="line">  ctx.<span class="title function_">save</span>();                  <span class="comment">// 保存当前状态</span></span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;#FFF&#x27;</span>       <span class="comment">// 再次改变颜色配置</span></span><br><span class="line">  ctx.<span class="property">globalAlpha</span> = <span class="number">0.5</span>;</span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">30</span>,<span class="number">30</span>,<span class="number">90</span>,<span class="number">90</span>);   <span class="comment">// 使用新的配置绘制一个矩形</span></span><br><span class="line"></span><br><span class="line">  ctx.<span class="title function_">restore</span>();               <span class="comment">// 重新加载之前的颜色状态</span></span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">45</span>,<span class="number">45</span>,<span class="number">60</span>,<span class="number">60</span>);   <span class="comment">// 使用上一次的配置绘制一个矩形</span></span><br><span class="line"></span><br><span class="line">  ctx.<span class="title function_">restore</span>();               <span class="comment">// 加载默认颜色配置</span></span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">60</span>,<span class="number">60</span>,<span class="number">30</span>,<span class="number">30</span>);   <span class="comment">// 使用加载的配置绘制一个矩形</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="移动-Translating"><a href="#移动-Translating" class="headerlink" title="移动 Translating"></a>移动 Translating</h2><p>我们先介绍 translate方法，它用来移动 canvas 和它的原点到一个不同的位置。</p>
<p>translate(x, y)</p>
<p>translate方法接受两个参数。<em>x </em>是左右偏移量，<em>y</em> 是上下偏移量，如右图所示。</p>
<p>在做变形之前先保存状态是一个良好的习惯。大多数情况下，调用 restore 方法比手动恢复原先的状态要简单得多。又，如果你是在一个循环中做位移但没有保存和恢复 canvas  的状态，很可能到最后会发现怎么有些东西不见了，那是因为它很可能已经超出 canvas 范围以外了。</p>
<h3 id="-48"><a href="#-48" class="headerlink" title=" "></a> </h3><h3 id="translate的例子"><a href="#translate的例子" class="headerlink" title="translate的例子"></a>translate的例子</h3><p>这个例子显示了一些移动 canvas 原点的好处。如果不使用  translate方法，那么所有矩形都将被绘制在相同的位置（0,0）。translate方法同时让我们可以任意放置这些图案，而不需要在  fillRect() 方法中手工调整坐标值，既好理解也方便使用。</p>
<p>我在 draw方法中调用 fillRect() 方法 9 次，用了 2 层循环。每一次循环，先移动 canvas，画螺旋图案，然后恢复到原始状态。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">      ctx.<span class="title function_">save</span>();</span><br><span class="line">      ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;rgb(&#x27;</span> + (<span class="number">51</span> * i) + <span class="string">&#x27;, &#x27;</span> + (<span class="number">255</span> - <span class="number">51</span> * i) + <span class="string">&#x27;, 255)&#x27;</span>;</span><br><span class="line">      ctx.<span class="title function_">translate</span>(<span class="number">10</span> + j * <span class="number">50</span>, <span class="number">10</span> + i * <span class="number">50</span>);</span><br><span class="line">      ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">25</span>, <span class="number">25</span>);</span><br><span class="line">      ctx.<span class="title function_">restore</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667227442902-fa85b858-88b7-4134-b5c2-c96ce10d9380.png" alt="img"></p>
<h2 id="-49"><a href="#-49" class="headerlink" title=" "></a> </h2><h2 id="旋转-Rotating"><a href="#旋转-Rotating" class="headerlink" title="旋转 Rotating"></a>旋转 Rotating</h2><p>第二个介绍 rotate方法，它用于以原点为中心旋转 canvas。</p>
<p>rotate(angle)</p>
<p>这个方法只接受一个参数：旋转的角度 (angle)，它是顺时针方向的，以弧度为单位的值。</p>
<p>旋转的中心点始终是 canvas 的原点，如果要改变它，我们需要用到 translate方法。</p>
<h3 id="-50"><a href="#-50" class="headerlink" title=" "></a> </h3><h3 id="rotate的例子"><a href="#rotate的例子" class="headerlink" title="rotate的例子"></a>rotate的例子</h3><p>在这个例子里，见右图，我用 rotate方法来画圆并构成圆形图案。当然你也可以分别计算出 <em>x</em> 和 <em>y</em> 坐标（x = r<em>Math.cos(a); y = r</em>Math.sin(a)）。这里无论用什么方法都无所谓的，因为我们画的是圆。计算坐标的结果只是旋转圆心位置，而不是圆本身。即使用 rotate旋转两者，那些圆看上去还是一样的，不管它们绕中心旋转有多远。</p>
<p>这里我们又用到了两层循环。第一层循环决定环的数量，第二层循环决定每环有多少个点。每环开始之前，我都保存一下 canvas 的状态，这样恢复起来方便。每次画圆点，我都以一定夹角来旋转 canvas，而这个夹角则是由环上的圆点数目的决定的。最里层的环有 6 个圆点，这样，每次旋转的夹角就是 360/6 = 60 度。往外每一环的圆点数目是里面一环的 2 倍，那么每次旋转的夹角随之减半。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667227528080-9fea6887-8d30-42ab-a278-69d95a5f1656.png" alt="img"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">  ctx.<span class="title function_">translate</span>(<span class="number">75</span>,<span class="number">75</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">1</span>;i&lt;<span class="number">6</span>;i++)&#123; <span class="comment">// Loop through rings (from inside to out)</span></span><br><span class="line">    ctx.<span class="title function_">save</span>();</span><br><span class="line">    ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;rgb(&#x27;</span>+(<span class="number">51</span>*i)+<span class="string">&#x27;,&#x27;</span>+(<span class="number">255</span>-<span class="number">51</span>*i)+<span class="string">&#x27;,255)&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;i*<span class="number">6</span>;j++)&#123; <span class="comment">// draw individual dots</span></span><br><span class="line">      ctx.<span class="title function_">rotate</span>(<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>/(i*<span class="number">6</span>));</span><br><span class="line">      ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">      ctx.<span class="title function_">arc</span>(<span class="number">0</span>,i*<span class="number">12.5</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>,<span class="literal">true</span>);</span><br><span class="line">      ctx.<span class="title function_">fill</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ctx.<span class="title function_">restore</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="缩放-Scaling-1"><a href="#缩放-Scaling-1" class="headerlink" title="缩放 Scaling"></a>缩放 Scaling</h2><p>接着是缩放。我们用它来增减图形在 canvas 中的像素数目，对形状，位图进行缩小或者放大。</p>
<p><strong>scale(x, y)</strong></p>
<p>scale方法可以缩放画布的水平和垂直的单位。两个参数都是实数，可以为负数，x 为水平缩放因子，y 为垂直缩放因子，如果比 1 小，会缩小图形，如果比 1 大会放大图形。默认值为 1，为实际大小。</p>
<p>画布初始情况下，是以左上角坐标为原点的第一象限。如果参数为负实数，相当于以 x 或 y 轴作为对称轴镜像反转（例如，使用translate(0,canvas.height); scale(1,-1); 以 y  轴作为对称轴镜像反转，就可得到著名的笛卡尔坐标系，左下角为原点）。</p>
<p>默认情况下，canvas 的 1 个单位为 1  个像素。举例说，如果我们设置缩放因子是 0.5，1 个单位就变成对应 0.5 个像素，这样绘制出来的形状就会是原先的一半。同理，设置为 2.0  时，1 个单位就对应变成了 2 像素，绘制的结果就是图形放大了 2 倍。</p>
<h3 id="-51"><a href="#-51" class="headerlink" title=" "></a> </h3><h3 id="scale的例子"><a href="#scale的例子" class="headerlink" title="scale的例子"></a>scale的例子</h3><p>这最后的例子里，我们用不同的缩放方式来画两个图形。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// draw a simple rectangle, but scale it.</span></span><br><span class="line">  ctx.<span class="title function_">save</span>();</span><br><span class="line">  ctx.<span class="title function_">scale</span>(<span class="number">10</span>, <span class="number">3</span>);</span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">1</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">  ctx.<span class="title function_">restore</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// mirror horizontally</span></span><br><span class="line">  ctx.<span class="title function_">scale</span>(-<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  ctx.<span class="property">font</span> = <span class="string">&#x27;48px serif&#x27;</span>;</span><br><span class="line">  ctx.<span class="title function_">fillText</span>(<span class="string">&#x27;MDN&#x27;</span>, -<span class="number">135</span>, <span class="number">120</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667227651471-39bb0784-882f-4fca-8b89-4702ac5fae3e.png" alt="img"></p>
<h2 id="-52"><a href="#-52" class="headerlink" title=" "></a> </h2><h2 id="变形-Transforms"><a href="#变形-Transforms" class="headerlink" title="变形 Transforms"></a>变形 Transforms</h2><p>最后一个方法允许对变形矩阵直接修改。</p>
<p>transform(a, b, c, d, e, f)</p>
<p>这个方法是将当前的变形矩阵乘上一个基于自身参数的矩阵，如下面的矩阵所示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667227677196-4449db4d-89f3-447a-b8fc-e6c8bb1e3597.png" alt="img"></p>
<p>如果任意一个参数是Infinity，变形矩阵也必须被标记为无限大，否则会抛出异常。</p>
<p>这个函数的参数各自代表如下：</p>
<p>a (m11)</p>
<p>水平方向的缩放</p>
<p>b(m12)</p>
<p>竖直方向的倾斜偏移</p>
<p>c(m21)</p>
<p>水平方向的倾斜偏移</p>
<p>d(m22)</p>
<p>竖直方向的缩放</p>
<p>e(dx)</p>
<p>水平方向的移动</p>
<p>f(dy)</p>
<p>竖直方向的移动</p>
<p>setTransform(a, b, c, d, e, f)</p>
<p>这个方法会将当前的变形矩阵重置为单位矩阵，然后用相同的参数调用 transform方法。如果任意一个参数是无限大，那么变形矩阵也必须被标记为无限大，否则会抛出异常。从根本上来说，该方法是取消了当前变形，然后设置为指定的变形，一步完成。</p>
<p>resetTransform()</p>
<p>重置当前变形为单位矩阵，它和调用以下语句是一样的：ctx.setTransform(1, 0, 0, 1, 0, 0);</p>
<h3 id="-53"><a href="#-53" class="headerlink" title=" "></a> </h3><h3 id="transform-setTransform的例子"><a href="#transform-setTransform的例子" class="headerlink" title="transform/setTransform的例子"></a>transform/setTransform的例子</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> sin = <span class="title class_">Math</span>.<span class="title function_">sin</span>(<span class="title class_">Math</span>.<span class="property">PI</span>/<span class="number">6</span>);</span><br><span class="line">  <span class="keyword">var</span> cos = <span class="title class_">Math</span>.<span class="title function_">cos</span>(<span class="title class_">Math</span>.<span class="property">PI</span>/<span class="number">6</span>);</span><br><span class="line">  ctx.<span class="title function_">translate</span>(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">  <span class="keyword">var</span> c = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt;= <span class="number">12</span>; i++) &#123;</span><br><span class="line">    c = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="number">255</span> / <span class="number">12</span> * i);</span><br><span class="line">    ctx.<span class="property">fillStyle</span> = <span class="string">&quot;rgb(&quot;</span> + c + <span class="string">&quot;,&quot;</span> + c + <span class="string">&quot;,&quot;</span> + c + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">10</span>);</span><br><span class="line">    ctx.<span class="title function_">transform</span>(cos, sin, -sin, cos, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ctx.<span class="title function_">setTransform</span>(-<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&quot;rgba(255, 128, 255, 0.5)&quot;</span>;</span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>, <span class="number">50</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667227715479-23deabde-be76-40c7-b5f0-0db094287d9f.png" alt="img"></p>
<h1 id="06-合成"><a href="#06-合成" class="headerlink" title="06-合成"></a>06-合成</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1668396610315-3bcf343e-80cc-4a7a-8aeb-2590b0f76f6d.png" alt="img"></p>
<p>我们总是将一个图形画在另一个之上，对于其他更多的情况，仅仅这样是远远不够的。比如，对合成的图形来说，绘制顺序会有限制。不过，我们可以利用 globalCompositeOperation  属性来改变这种状况。此外，clip属性允许我们隐藏不想看到的部分图形。这个刮刮乐的案例就需要用到globalCompositeOperation 属性</p>
<h2 id="-54"><a href="#-54" class="headerlink" title=" "></a> </h2><h2 id="globalCompositeOperation"><a href="#globalCompositeOperation" class="headerlink" title="globalCompositeOperation"></a>globalCompositeOperation</h2><p>我们不仅可以在已有图形后面再画新图形，还可以用来遮盖指定区域，清除画布中的某些部分（清除区域不仅限于矩形，像clearRect()方法做的那样）以及更多其他操作。</p>
<p>globalCompositeOperation = type</p>
<p>这个属性设定了在画新图形时采用的遮盖策略，其值是一个标识 12 种遮盖方式的字符串。</p>
<p>查看下面Compositing 示例的代码。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667109996773-cc3490b4-fcc0-440b-a78a-563a22c87ec9.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667110038147-e02ef7a9-286f-4caf-b11a-052404004c4b.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667110060118-a77bca85-5791-411a-baf3-f23448125b8b.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667110101069-d2835e2a-8e88-41f0-9b76-35a20c887f5d.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667110185013-56c094f6-4a88-490b-9a90-1177963acd1c.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667110207449-ea21b03d-ff30-4b18-a2ea-471b385896f6.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667110229371-841a71a6-7c64-4c8e-b6c6-18859a227c9f.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667110255686-de491c8c-3e75-4ed4-aa95-b3beec319ae0.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667110271165-f69f9053-1d37-41c8-8d00-d47ebbfe691a.png" alt="img"></p>
<h1 id="07-剪裁"><a href="#07-剪裁" class="headerlink" title="07-剪裁"></a>07-剪裁</h1><h2 id="裁切路径"><a href="#裁切路径" class="headerlink" title="裁切路径"></a>裁切路径</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667110508409-e7532df3-4c14-4c79-a61a-f9b7b2a51f0f.png" alt="img"></p>
<p>裁切路径和普通的 canvas 图形差不多，不同的是它的作用是遮罩，用来隐藏不需要的部分。如右图所示。红边五角星就是裁切路径，所有在路径以外的部分都不会在 canvas 上绘制出来。</p>
<p>如果和上面介绍的 globalCompositeOperation 属性作一比较，它可以实现与 source-in 和  source-atop差不多的效果。最重要的区别是裁切路径不会在 canvas  上绘制东西，而且它永远不受新图形的影响。这些特性使得它在特定区域里绘制图形时相当好用。</p>
<p>在 绘制图形 一章中，我只介绍了 stroke 和 fill 方法，这里介绍第三个方法clip。</p>
<p>clip()</p>
<p>将当前正在构建的路径转换为当前的裁剪路径。</p>
<p>我们使用 clip()方法来创建一个新的裁切路径。</p>
<p>默认情况下，canvas 有一个与它自身一样大的裁切路径（也就是没有裁切效果）。</p>
<h3 id="-55"><a href="#-55" class="headerlink" title=" "></a> </h3><h3 id="clip的例子"><a href="#clip的例子" class="headerlink" title="clip的例子"></a>clip的例子</h3><p>这个例子，我会用一个圆形的裁切路径来限制随机星星的绘制区域。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">function draw() &#123;</span><br><span class="line">  var ctx = document.getElementById(&#x27;canvas&#x27;).getContext(&#x27;2d&#x27;);</span><br><span class="line">  ctx.fillRect(0,0,150,150);</span><br><span class="line">  ctx.translate(75,75);</span><br><span class="line"></span><br><span class="line">  // Create a circular clipping path</span><br><span class="line">  ctx.beginPath();</span><br><span class="line">  ctx.arc(0,0,60,0,Math.PI*2,true);</span><br><span class="line">  ctx.clip();</span><br><span class="line"></span><br><span class="line">  // draw background</span><br><span class="line">  var lingrad = ctx.createLinearGradient(0,-75,0,75);</span><br><span class="line">  lingrad.addColorStop(0, &#x27;#232256&#x27;);</span><br><span class="line">  lingrad.addColorStop(1, &#x27;#143778&#x27;);</span><br><span class="line"></span><br><span class="line">  ctx.fillStyle = lingrad;</span><br><span class="line">  ctx.fillRect(-75,-75,150,150);</span><br><span class="line"></span><br><span class="line">  // draw stars</span><br><span class="line">  for (var j=1;j&lt;50;j++)&#123;</span><br><span class="line">    ctx.save();</span><br><span class="line">    ctx.fillStyle = &#x27;#fff&#x27;;</span><br><span class="line">    ctx.translate(75-Math.floor(Math.random()*150),</span><br><span class="line">                  75-Math.floor(Math.random()*150));</span><br><span class="line">    drawStar(ctx,Math.floor(Math.random()*4)+2);</span><br><span class="line">    ctx.restore();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">function drawStar(ctx,r)&#123;</span><br><span class="line">  ctx.save();</span><br><span class="line">  ctx.beginPath()</span><br><span class="line">  ctx.moveTo(r,0);</span><br><span class="line">  for (var i=0;i&lt;9;i++)&#123;</span><br><span class="line">    ctx.rotate(Math.PI/5);</span><br><span class="line">    if(i%2 == 0) &#123;</span><br><span class="line">      ctx.lineTo((r/0.525731)*0.200811,0);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      ctx.lineTo(r,0);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ctx.closePath();</span><br><span class="line">  ctx.fill();</span><br><span class="line">  ctx.restore();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先，我画了一个与 canvas 一样大小的黑色方形作为背景，然后移动原点至中心点。然后用 clip 方法创建一个弧形的裁切路径。裁切路径也属于 canvas  状态的一部分，可以被保存起来。如果我们在创建新裁切路径时想保留原来的裁切路径，我们需要做的就是保存一下 canvas 的状态。</p>
<p>裁切路径创建之后所有出现在它里面的东西才会画出来。在画线性渐变时我们就会注意到这点。然后会绘制出 50 颗随机位置分布（经过缩放）的星星，当然也只有在裁切路径里面的星星才会绘制出来。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667110658524-fbc7a711-50c5-439a-8b0e-029f8880169b.png" alt="img"></p>
<h1 id="08-基本的动画"><a href="#08-基本的动画" class="headerlink" title="08-基本的动画"></a>08-基本的动画</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1668396969271-76770864-e005-4080-82a2-ec02c0e972cc.png" alt="img"></p>
<p>由于我们是用 JavaScript 去操控 canvas 对象，这样要实现一些交互动画也是相当容易的。在本章中，我们将看看如何做一些基本的动画。</p>
<p>可能最大的限制就是图像一旦绘制出来，它就是一直保持那样了。如果需要移动它，我们不得不对所有东西（包括之前的）进行重绘。重绘是相当费时的，而且性能很依赖于电脑的速度。</p>
<h2 id="-56"><a href="#-56" class="headerlink" title=" "></a> </h2><h2 id="动画的基本步骤"><a href="#动画的基本步骤" class="headerlink" title="动画的基本步骤"></a>动画的基本步骤</h2><p>你可以通过以下的步骤来画出一帧：</p>
<ol>
<li><strong>清空 canvas</strong> 除非接下来要画的内容会完全充满 canvas（例如背景图），否则你需要清空所有。最简单的做法就是用 clearRect 方法。</li>
<li><strong>保存 canvas 状态</strong> 如果你要改变一些会改变 canvas 状态的设置（样式，变形之类的），又要在每画一帧之时都是原始状态的话，你需要先保存一下。</li>
<li><strong>绘制动画图形（animated shapes）</strong> 这一步才是重绘动画帧。</li>
<li><strong>恢复 canvas 状态</strong> 如果已经保存了 canvas 的状态，可以先恢复它，然后重绘下一帧。</li>
</ol>
<h2 id="-57"><a href="#-57" class="headerlink" title=" "></a> </h2><h2 id="操控动画-Controlling-an-animation"><a href="#操控动画-Controlling-an-animation" class="headerlink" title="操控动画 Controlling an animation"></a>操控动画 Controlling an animation</h2><p>在 canvas 上绘制内容是用 canvas 提供的或者自定义的方法，而通常，我们仅仅在脚本执行结束后才能看见结果，比如说，在 for 循环里面做完成动画是不太可能的。</p>
<p>因此，为了实现动画，我们需要一些可以定时执行重绘的方法。有两种方法可以实现这样的动画操控。首先可以通过 setInterval 和 setTimeout 方法来控制在设定的时间点上执行重绘。</p>
<h3 id="-58"><a href="#-58" class="headerlink" title=" "></a> </h3><h3 id="有安排的更新画布Scheduled-updates"><a href="#有安排的更新画布Scheduled-updates" class="headerlink" title="有安排的更新画布Scheduled updates"></a>有安排的更新画布Scheduled updates</h3><p>首先，可以用window.setInterval(), window.setTimeout(),和window.requestAnimationFrame()来设定定期执行一个指定函数。</p>
<p>setInterval(function, delay)(en-US)</p>
<p>当设定好间隔时间后，function 会定期执行。</p>
<p>setTimeout(function, delay)(en-US)</p>
<p>在设定好的时间之后执行函数</p>
<p>requestAnimationFrame(callback)</p>
<p>告诉浏览器你希望执行一个动画，并在重绘之前，请求浏览器执行一个特定的函数来更新动画。</p>
<p>如果你并不需要与用户互动，你可以使用 setInterval() 方法，它就可以定期执行指定代码。如果我们需要做一个游戏，我们可以使用键盘或者鼠标事件配合上 setTimeout() 方法来实现。通过设置事件监听，我们可以捕捉用户的交互，并执行相应的动作。</p>
<p>下面的例子，采用 window.requestAnimationFrame()实现动画效果。这个方法提供了更加平缓并更加有效率的方式来执行动画，当系统准备好了重绘条件的时候，才调用绘制动画帧。一般每秒钟回调函数执行 60 次，也有可能会被降低。</p>
<h2 id="-59"><a href="#-59" class="headerlink" title=" "></a> </h2><h2 id="太阳系的动画"><a href="#太阳系的动画" class="headerlink" title="太阳系的动画"></a>太阳系的动画</h2><p>这个例子里面，我会做一个小型的太阳系模拟动画。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sun = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line"><span class="keyword">var</span> moon = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line"><span class="keyword">var</span> earth = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">init</span>(<span class="params"></span>)&#123;</span><br><span class="line">  sun.<span class="property">src</span> = <span class="string">&#x27;https://mdn.mozillademos.org/files/1456/Canvas_sun.png&#x27;</span>;</span><br><span class="line">  moon.<span class="property">src</span> = <span class="string">&#x27;https://mdn.mozillademos.org/files/1443/Canvas_moon.png&#x27;</span>;</span><br><span class="line">  earth.<span class="property">src</span> = <span class="string">&#x27;https://mdn.mozillademos.org/files/1429/Canvas_earth.png&#x27;</span>;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">requestAnimationFrame</span>(draw);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  ctx.<span class="property">globalCompositeOperation</span> = <span class="string">&#x27;destination-over&#x27;</span>;</span><br><span class="line">  ctx.<span class="title function_">clearRect</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">300</span>,<span class="number">300</span>); <span class="comment">// clear canvas</span></span><br><span class="line"></span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;rgba(0,0,0,0.4)&#x27;</span>;</span><br><span class="line">  ctx.<span class="property">strokeStyle</span> = <span class="string">&#x27;rgba(0,153,255,0.4)&#x27;</span>;</span><br><span class="line">  ctx.<span class="title function_">save</span>();</span><br><span class="line">  ctx.<span class="title function_">translate</span>(<span class="number">150</span>,<span class="number">150</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Earth</span></span><br><span class="line">  <span class="keyword">var</span> time = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">  ctx.<span class="title function_">rotate</span>( ((<span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>)/<span class="number">60</span>)*time.<span class="title function_">getSeconds</span>() + ((<span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>)/<span class="number">60000</span>)*time.<span class="title function_">getMilliseconds</span>() );</span><br><span class="line">  ctx.<span class="title function_">translate</span>(<span class="number">105</span>,<span class="number">0</span>);</span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>,-<span class="number">12</span>,<span class="number">50</span>,<span class="number">24</span>); <span class="comment">// Shadow</span></span><br><span class="line">  ctx.<span class="title function_">drawImage</span>(earth,-<span class="number">12</span>,-<span class="number">12</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Moon</span></span><br><span class="line">  ctx.<span class="title function_">save</span>();</span><br><span class="line">  ctx.<span class="title function_">rotate</span>( ((<span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>)/<span class="number">6</span>)*time.<span class="title function_">getSeconds</span>() + ((<span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>)/<span class="number">6000</span>)*time.<span class="title function_">getMilliseconds</span>() );</span><br><span class="line">  ctx.<span class="title function_">translate</span>(<span class="number">0</span>,<span class="number">28.5</span>);</span><br><span class="line">  ctx.<span class="title function_">drawImage</span>(moon,-<span class="number">3.5</span>,-<span class="number">3.5</span>);</span><br><span class="line">  ctx.<span class="title function_">restore</span>();</span><br><span class="line"></span><br><span class="line">  ctx.<span class="title function_">restore</span>();</span><br><span class="line"></span><br><span class="line">  ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">  ctx.<span class="title function_">arc</span>(<span class="number">150</span>,<span class="number">150</span>,<span class="number">105</span>,<span class="number">0</span>,<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>,<span class="literal">false</span>); <span class="comment">// Earth orbit</span></span><br><span class="line">  ctx.<span class="title function_">stroke</span>();</span><br><span class="line"></span><br><span class="line">  ctx.<span class="title function_">drawImage</span>(sun,<span class="number">0</span>,<span class="number">0</span>,<span class="number">300</span>,<span class="number">300</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">requestAnimationFrame</span>(draw);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">init</span>();</span><br></pre></td></tr></table></figure>
<h2 id="动画时钟"><a href="#动画时钟" class="headerlink" title="动画时钟"></a>动画时钟</h2><p>这个例子实现一个动态时钟，可以显示当前时间。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">clock</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">  ctx.<span class="title function_">save</span>();</span><br><span class="line">  ctx.<span class="title function_">clearRect</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">150</span>,<span class="number">150</span>);</span><br><span class="line">  ctx.<span class="title function_">translate</span>(<span class="number">75</span>,<span class="number">75</span>);</span><br><span class="line">  ctx.<span class="title function_">scale</span>(<span class="number">0.4</span>,<span class="number">0.4</span>);</span><br><span class="line">  ctx.<span class="title function_">rotate</span>(-<span class="title class_">Math</span>.<span class="property">PI</span>/<span class="number">2</span>);</span><br><span class="line">  ctx.<span class="property">strokeStyle</span> = <span class="string">&quot;black&quot;</span>;</span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&quot;white&quot;</span>;</span><br><span class="line">  ctx.<span class="property">lineWidth</span> = <span class="number">8</span>;</span><br><span class="line">  ctx.<span class="property">lineCap</span> = <span class="string">&quot;round&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Hour marks</span></span><br><span class="line">  ctx.<span class="title function_">save</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">12</span>;i++)&#123;</span><br><span class="line">    ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">    ctx.<span class="title function_">rotate</span>(<span class="title class_">Math</span>.<span class="property">PI</span>/<span class="number">6</span>);</span><br><span class="line">    ctx.<span class="title function_">moveTo</span>(<span class="number">100</span>,<span class="number">0</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">120</span>,<span class="number">0</span>);</span><br><span class="line">    ctx.<span class="title function_">stroke</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  ctx.<span class="title function_">restore</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Minute marks</span></span><br><span class="line">  ctx.<span class="title function_">save</span>();</span><br><span class="line">  ctx.<span class="property">lineWidth</span> = <span class="number">5</span>;</span><br><span class="line">  <span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">60</span>;i++)&#123;</span><br><span class="line">    <span class="keyword">if</span> (i%<span class="number">5</span>!=<span class="number">0</span>) &#123;</span><br><span class="line">      ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">      ctx.<span class="title function_">moveTo</span>(<span class="number">117</span>,<span class="number">0</span>);</span><br><span class="line">      ctx.<span class="title function_">lineTo</span>(<span class="number">120</span>,<span class="number">0</span>);</span><br><span class="line">      ctx.<span class="title function_">stroke</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    ctx.<span class="title function_">rotate</span>(<span class="title class_">Math</span>.<span class="property">PI</span>/<span class="number">30</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  ctx.<span class="title function_">restore</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> sec = now.<span class="title function_">getSeconds</span>();</span><br><span class="line">  <span class="keyword">var</span> min = now.<span class="title function_">getMinutes</span>();</span><br><span class="line">  <span class="keyword">var</span> hr  = now.<span class="title function_">getHours</span>();</span><br><span class="line">  hr = hr&gt;=<span class="number">12</span> ? hr-<span class="number">12</span> : hr;</span><br><span class="line"></span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&quot;black&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// write Hours</span></span><br><span class="line">  ctx.<span class="title function_">save</span>();</span><br><span class="line">  ctx.<span class="title function_">rotate</span>( hr*(<span class="title class_">Math</span>.<span class="property">PI</span>/<span class="number">6</span>) + (<span class="title class_">Math</span>.<span class="property">PI</span>/<span class="number">360</span>)*min + (<span class="title class_">Math</span>.<span class="property">PI</span>/<span class="number">21600</span>)*sec )</span><br><span class="line">  ctx.<span class="property">lineWidth</span> = <span class="number">14</span>;</span><br><span class="line">  ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">  ctx.<span class="title function_">moveTo</span>(-<span class="number">20</span>,<span class="number">0</span>);</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(<span class="number">80</span>,<span class="number">0</span>);</span><br><span class="line">  ctx.<span class="title function_">stroke</span>();</span><br><span class="line">  ctx.<span class="title function_">restore</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// write Minutes</span></span><br><span class="line">  ctx.<span class="title function_">save</span>();</span><br><span class="line">  ctx.<span class="title function_">rotate</span>( (<span class="title class_">Math</span>.<span class="property">PI</span>/<span class="number">30</span>)*min + (<span class="title class_">Math</span>.<span class="property">PI</span>/<span class="number">1800</span>)*sec )</span><br><span class="line">  ctx.<span class="property">lineWidth</span> = <span class="number">10</span>;</span><br><span class="line">  ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">  ctx.<span class="title function_">moveTo</span>(-<span class="number">28</span>,<span class="number">0</span>);</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(<span class="number">112</span>,<span class="number">0</span>);</span><br><span class="line">  ctx.<span class="title function_">stroke</span>();</span><br><span class="line">  ctx.<span class="title function_">restore</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Write seconds</span></span><br><span class="line">  ctx.<span class="title function_">save</span>();</span><br><span class="line">  ctx.<span class="title function_">rotate</span>(sec * <span class="title class_">Math</span>.<span class="property">PI</span>/<span class="number">30</span>);</span><br><span class="line">  ctx.<span class="property">strokeStyle</span> = <span class="string">&quot;#D40000&quot;</span>;</span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&quot;#D40000&quot;</span>;</span><br><span class="line">  ctx.<span class="property">lineWidth</span> = <span class="number">6</span>;</span><br><span class="line">  ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">  ctx.<span class="title function_">moveTo</span>(-<span class="number">30</span>,<span class="number">0</span>);</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(<span class="number">83</span>,<span class="number">0</span>);</span><br><span class="line">  ctx.<span class="title function_">stroke</span>();</span><br><span class="line">  ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">  ctx.<span class="title function_">arc</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>,<span class="literal">true</span>);</span><br><span class="line">  ctx.<span class="title function_">fill</span>();</span><br><span class="line">  ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">  ctx.<span class="title function_">arc</span>(<span class="number">95</span>,<span class="number">0</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>,<span class="literal">true</span>);</span><br><span class="line">  ctx.<span class="title function_">stroke</span>();</span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&quot;rgba(0,0,0,0)&quot;</span>;</span><br><span class="line">  ctx.<span class="title function_">arc</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>,<span class="literal">true</span>);</span><br><span class="line">  ctx.<span class="title function_">fill</span>();</span><br><span class="line">  ctx.<span class="title function_">restore</span>();</span><br><span class="line"></span><br><span class="line">  ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">  ctx.<span class="property">lineWidth</span> = <span class="number">14</span>;</span><br><span class="line">  ctx.<span class="property">strokeStyle</span> = <span class="string">&#x27;#325FA2&#x27;</span>;</span><br><span class="line">  ctx.<span class="title function_">arc</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">142</span>,<span class="number">0</span>,<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>,<span class="literal">true</span>);</span><br><span class="line">  ctx.<span class="title function_">stroke</span>();</span><br><span class="line"></span><br><span class="line">  ctx.<span class="title function_">restore</span>();</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">requestAnimationFrame</span>(clock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">requestAnimationFrame</span>(clock);</span><br></pre></td></tr></table></figure>
<h1 id="09-像素操作"><a href="#09-像素操作" class="headerlink" title="09-像素操作"></a>09-像素操作</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1668397235760-c2217634-7644-4a76-8f6c-dd97c860dd6c.gif" alt="img"></p>
<p>到目前为止，我们尚未深入了解 Canvas 画布真实像素的原理，事实上，你可以直接通过 ImageData 对象操纵像素数据，直接读取或将数据数组写入该对象中。稍后我们也将深入了解如何控制图像使其平滑（反锯齿）以及如何从 Canvas 画布中保存图像。</p>
<h2 id="-60"><a href="#-60" class="headerlink" title=" "></a> </h2><h2 id="ImageData-对象"><a href="#ImageData-对象" class="headerlink" title="ImageData 对象"></a>ImageData 对象</h2><p>ImageData对象中存储着 canvas 对象真实的像素数据，它包含以下几个只读属性：</p>
<p>width</p>
<p>图片宽度，单位是像素</p>
<p>height</p>
<p>图片高度，单位是像素</p>
<p>data</p>
<p>Uint8ClampedArray 类型的一维数组，包含着 RGBA 格式的整型数据，范围在 0 至 255 之间（包括 255）。</p>
<p>data 属性返回一个 Uint8ClampedArray，它可以被使用作为查看初始像素数据。每个像素用 4 个 1bytes 值  (按照红，绿，蓝和透明值的顺序; 这就是”RGBA”格式) 来代表。每个颜色值部份用 0 至 255  来代表。每个部份被分配到一个在数组内连续的索引，左上角像素的红色部份在数组的索引 0 位置。像素从左到右被处理，然后往下，遍历整个数组。</p>
<p>Uint8ClampedArray 包含高度 × 宽度 × 4 bytes 数据，索引值从 0 到 (高度× 宽度 ×4)-1</p>
<p>例如，要读取图片中位于第 50 行，第 200 列的像素的蓝色部份，你会写以下代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blueComponent = imageData.<span class="property">data</span>[((<span class="number">50</span> * (imageData.<span class="property">width</span> * <span class="number">4</span>)) + (<span class="number">200</span> * <span class="number">4</span>)) + <span class="number">2</span>];</span><br></pre></td></tr></table></figure>
<p>根据行、列读取某像素点的 R/G/B/A 值的公式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imageData.<span class="property">data</span>[((<span class="number">50</span> * (imageData.<span class="property">width</span> * <span class="number">4</span>)) + (<span class="number">200</span> * <span class="number">4</span>)) + <span class="number">0</span>/<span class="number">1</span>/<span class="number">2</span>/<span class="number">3</span>];</span><br></pre></td></tr></table></figure>
<p>你可能用会使用 Uint8ClampedArray.length 属性来读取像素数组的大小（以 bytes 为单位）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> numBytes = imageData.<span class="property">data</span>.<span class="property">length</span>;</span><br></pre></td></tr></table></figure>
<h2 id="创建一个-ImageData-对象"><a href="#创建一个-ImageData-对象" class="headerlink" title="创建一个 ImageData 对象"></a>创建一个 ImageData 对象</h2><p>去创建一个新的，空白的 ImageData对象，你应该会使用createImageData() 方法。有 2 个版本的 createImageData() 方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myImageData = ctx.<span class="title function_">createImageData</span>(width, height);</span><br></pre></td></tr></table></figure>
<p>上面代码创建了一个新的具体特定尺寸的 ImageData对象。所有像素被预设为透明黑。</p>
<p>你也可以创建一个被 anotherImageData对象指定的相同像素的 ImageData对象。这个新的对象像素全部被预设为透明黑。这个并非复制了图片数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myImageData = ctx.<span class="title function_">createImageData</span>(anotherImageData);</span><br></pre></td></tr></table></figure>
<h2 id="得到场景像素数据"><a href="#得到场景像素数据" class="headerlink" title="得到场景像素数据"></a>得到场景像素数据</h2><p>为了获得一个包含画布场景像素数据的 ImageData 对像，你可以用 getImageData() 方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myImageData = ctx.<span class="title function_">getImageData</span>(left, top, width, height);</span><br></pre></td></tr></table></figure>
<p>这个方法会返回一个 ImageData对象，它代表了画布区域的对象数据，此画布的四个角落分别表示为 (left, top), (left + width,  top), (left, top + height), 以及 (left + width, top + height)  四个点。这些坐标点被设定为画布坐标空间元素。</p>
<p>任何在画布以外的元素都会被返回成一个透明黑的 ImageData 对像。</p>
<h3 id="-61"><a href="#-61" class="headerlink" title=" "></a> </h3><h3 id="颜色选择器"><a href="#颜色选择器" class="headerlink" title="颜色选择器"></a>颜色选择器</h3><p>在这个例子里面，我们会使用getImageData()去展示鼠标光标下的颜色。为此，我们要当前鼠标的位置，记为 layerX 和  layerY，然后我们去查询getImageData()给我们提供的在那个位置的像数数组里面的像素数据。最后我们使用数组数据去设置背景颜色和div的文字去展示颜色值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">img.<span class="property">crossOrigin</span> = <span class="string">&#x27;anonymous&#x27;</span>;</span><br><span class="line">img.<span class="property">src</span> = <span class="string">&#x27;./assets/rhino.jpg&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">img.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  ctx.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  img.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> hoveredColor = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;hovered-color&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> selectedColor = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;selected-color&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">pick</span>(<span class="params">event, destination</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> x = event.<span class="property">layerX</span>;</span><br><span class="line">  <span class="keyword">var</span> y = event.<span class="property">layerY</span>;</span><br><span class="line">  <span class="keyword">var</span> pixel = ctx.<span class="title function_">getImageData</span>(x, y, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">var</span> data = pixel.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> rgba = <span class="string">`rgba(<span class="subst">$&#123;data[<span class="number">0</span>]&#125;</span>, <span class="subst">$&#123;data[<span class="number">1</span>]&#125;</span>, <span class="subst">$&#123;data[<span class="number">2</span>]&#125;</span>, <span class="subst">$&#123;data[<span class="number">3</span>] / <span class="number">255</span>&#125;</span>)`</span>;</span><br><span class="line">    destination.<span class="property">style</span>.<span class="property">background</span> = rgba;</span><br><span class="line">    destination.<span class="property">textContent</span> = rgba;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rgba;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">canvas.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mousemove&#x27;</span>, <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="title function_">pick</span>(event, hoveredColor);</span><br><span class="line">&#125;);</span><br><span class="line">canvas.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="title function_">pick</span>(event, selectedColor);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667111496158-a89a03f4-7def-438d-ac5f-bff66c5630d2.png" alt="img"></p>
<h2 id="-62"><a href="#-62" class="headerlink" title=" "></a> </h2><h2 id="在场景中写入像素数据"><a href="#在场景中写入像素数据" class="headerlink" title="在场景中写入像素数据"></a>在场景中写入像素数据</h2><p>你可以用 putImageData() 方法去对场景进行像素数据的写入。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">putImageData</span>(myImageData, dx, dy);</span><br></pre></td></tr></table></figure>
<p>dx 和 dy 参数表示你希望在场景内左上角绘制的像素数据所得到的设备坐标。</p>
<p>例如，为了在场景内左上角绘制 myImageData 代表的图片，你可以写如下的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">putImageData</span>(myImageData, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h3 id="图片灰度和反相颜色"><a href="#图片灰度和反相颜色" class="headerlink" title="图片灰度和反相颜色"></a>图片灰度和反相颜色</h3><p>在这个例子里，我们遍历所有像素以改变他们的数值。然后我们将被修改的像素数组通过 putImageData() 放回到画布中去。invert 函数仅仅是去减掉颜色的最大色值 255.grayscale  函数仅仅是用红绿和蓝的平均值。你也可以用加权平均，例如 x = 0.299r + 0.587g + 0.114b  这个公式。更多资料请参考维基百科的Grayscale。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">img.<span class="property">crossOrigin</span> = <span class="string">&#x27;anonymous&#x27;</span>;</span><br><span class="line">img.<span class="property">src</span> = <span class="string">&#x27;./assets/rhino.jpg&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">img.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    ctx.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> original = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    ctx.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> invert = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    ctx.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> imageData = ctx.<span class="title function_">getImageData</span>(<span class="number">0</span>, <span class="number">0</span>, canvas.<span class="property">width</span>, canvas.<span class="property">height</span>);</span><br><span class="line">    <span class="keyword">const</span> data = imageData.<span class="property">data</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.<span class="property">length</span>; i += <span class="number">4</span>) &#123;</span><br><span class="line">        data[i]     = <span class="number">255</span> - data[i];     <span class="comment">// red</span></span><br><span class="line">        data[i + <span class="number">1</span>] = <span class="number">255</span> - data[i + <span class="number">1</span>]; <span class="comment">// green</span></span><br><span class="line">        data[i + <span class="number">2</span>] = <span class="number">255</span> - data[i + <span class="number">2</span>]; <span class="comment">// blue</span></span><br><span class="line">    &#125;</span><br><span class="line">    ctx.<span class="title function_">putImageData</span>(imageData, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> grayscale = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    ctx.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> imageData = ctx.<span class="title function_">getImageData</span>(<span class="number">0</span>, <span class="number">0</span>, canvas.<span class="property">width</span>, canvas.<span class="property">height</span>);</span><br><span class="line">    <span class="keyword">const</span> data = imageData.<span class="property">data</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.<span class="property">length</span>; i += <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> avg = (data[i] + data[i + <span class="number">1</span>] + data[i + <span class="number">2</span>]) / <span class="number">3</span>;</span><br><span class="line">        data[i]     = avg; <span class="comment">// red</span></span><br><span class="line">        data[i + <span class="number">1</span>] = avg; <span class="comment">// green</span></span><br><span class="line">        data[i + <span class="number">2</span>] = avg; <span class="comment">// blue</span></span><br><span class="line">    &#125;</span><br><span class="line">    ctx.<span class="title function_">putImageData</span>(imageData, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> inputs = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;[name=color]&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> input <span class="keyword">of</span> inputs) &#123;</span><br><span class="line">    input.<span class="title function_">addEventListener</span>(<span class="string">&quot;change&quot;</span>, <span class="keyword">function</span>(<span class="params">evt</span>) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (evt.<span class="property">target</span>.<span class="property">value</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;inverted&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">invert</span>();</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;grayscale&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">grayscale</span>();</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">original</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://threejs-1251830808.cos.ap-guangzhou.myqcloud.com/1667111755370-7e0e3202-3d0c-4a39-9e96-57912ec84ff2.png" alt="img"></p>
<h2 id="-63"><a href="#-63" class="headerlink" title=" "></a> </h2><h2 id="缩放和反锯齿"><a href="#缩放和反锯齿" class="headerlink" title="缩放和反锯齿"></a>缩放和反锯齿</h2><p>在drawImage() 方法，第二个画布和imageSmoothingEnabled 属性的帮助下，我们可以放大显示我们的图片及看到详情内容。</p>
<p>我们得到鼠标的位置并裁剪出距左和上 5 像素，距右和下 5 像素的图片。然后我们将这幅图复制到另一个画布然后将图片调整到我们想要的大小。在缩放画布里，我们将 10×10 像素的对原画布的裁剪调整为 200×200。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zoomctx.<span class="title function_">drawImage</span>(canvas,</span><br><span class="line">                  <span class="title class_">Math</span>.<span class="title function_">abs</span>(x - <span class="number">5</span>), <span class="title class_">Math</span>.<span class="title function_">abs</span>(y - <span class="number">5</span>),</span><br><span class="line">                  <span class="number">10</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>);</span><br></pre></td></tr></table></figure>
<p>imageSmoothingEnabled 属性的效果（不同浏览器需要不同前缀）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;canvas id=<span class="string">&quot;canvas&quot;</span> width=<span class="string">&quot;300&quot;</span> height=<span class="string">&quot;227&quot;</span>&gt;&lt;/canvas&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;zoom&quot;</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">height</span>=<span class="string">&quot;227&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;smoothbtn&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;smoothbtn&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span> <span class="attr">id</span>=<span class="string">&quot;smoothbtn&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  Enable image smoothing</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>ZOOM EXAMPLE</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas&quot;</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">height</span>=<span class="string">&quot;227&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;zoom&quot;</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">height</span>=<span class="string">&quot;227&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;smoothbtn&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;smoothbtn&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span> <span class="attr">id</span>=<span class="string">&quot;smoothbtn&quot;</span>&gt;</span></span><br><span class="line">    Enable image smoothing</span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>JavaScript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">img.<span class="property">src</span> = <span class="string">&#x27;https://mdn.mozillademos.org/files/5397/rhino.jpg&#x27;</span>;</span><br><span class="line">img.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">draw</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params">img</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">  ctx.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  img.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> zoomctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;zoom&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> smoothbtn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;smoothbtn&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> toggleSmoothing = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    zoomctx.<span class="property">imageSmoothingEnabled</span> = <span class="variable language_">this</span>.<span class="property">checked</span>;</span><br><span class="line">    zoomctx.<span class="property">mozImageSmoothingEnabled</span> = <span class="variable language_">this</span>.<span class="property">checked</span>;</span><br><span class="line">    zoomctx.<span class="property">webkitImageSmoothingEnabled</span> = <span class="variable language_">this</span>.<span class="property">checked</span>;</span><br><span class="line">    zoomctx.<span class="property">msImageSmoothingEnabled</span> = <span class="variable language_">this</span>.<span class="property">checked</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  smoothbtn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;change&#x27;</span>, toggleSmoothing);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> zoom = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> x = event.<span class="property">layerX</span>;</span><br><span class="line">    <span class="keyword">var</span> y = event.<span class="property">layerY</span>;</span><br><span class="line">    zoomctx.<span class="title function_">drawImage</span>(canvas,</span><br><span class="line">                      <span class="title class_">Math</span>.<span class="title function_">abs</span>(x - <span class="number">5</span>),</span><br><span class="line">                      <span class="title class_">Math</span>.<span class="title function_">abs</span>(y - <span class="number">5</span>),</span><br><span class="line">                      <span class="number">10</span>, <span class="number">10</span>,</span><br><span class="line">                      <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                      <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  canvas.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mousemove&#x27;</span>, zoom);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="保存图片"><a href="#保存图片" class="headerlink" title="保存图片"></a>保存图片</h2><p>HTMLCanvasElement 提供一个 toDataURL() 方法，此方法在保存图片的时候非常有用。它返回一个包含被类型参数规定的图像表现格式的数据链接。返回的图片分辨率是 96dpi。</p>
<p>canvas.toDataURL(‘image/png’)</p>
<p>默认设定。创建一个 PNG 图片。</p>
<p>canvas.toDataURL(‘image/jpeg’, quality)</p>
<p>创建一个 JPG 图片。你可以有选择地提供从 0 到 1 的品质量，1 表示最好品质，0 基本不被辨析但有比较小的文件大小。</p>
<p>当你从画布中生成了一个数据链接，例如，你可以将它用于任何image元素，或者将它放在一个有 download 属性的超链接里用于保存到本地。</p>
<p>你也可以从画布中创建一个Blob对像。</p>
<p>canvas.toBlob(callback, type, encoderOptions)</p>
<p>这个创建了一个在画布中的代表图片的 Blob 对像。</p>
<h1 id="10-图形元素交回"><a href="#10-图形元素交回" class="headerlink" title="10-图形元素交回"></a>10-图形元素交回</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>isPointInPath()判断路径中是否包含监测点（作为参数传入）。</p>
<h2 id="-64"><a href="#-64" class="headerlink" title=" "></a> </h2><h2 id="isPointInPath-介绍"><a href="#isPointInPath-介绍" class="headerlink" title="isPointInPath()介绍"></a>isPointInPath()介绍</h2><p>方法 描述 boolean ctx.isPointInPath(x, y) 判断监测点(x，y)是否在路径内 boolean  ctx.isPointInPath(x, y, fillRule)  判断监测点(x，y)和路径的位置关系，通过fillRule来决定是路径内还是路径外。fillRule的可选参数是nonzero(非零环绕算法)和evenadd(奇偶环绕算法)</p>
<h3 id="-65"><a href="#-65" class="headerlink" title=" "></a> </h3><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>如果context.rect(10,10,100,100)，那么所有在这个路径内的点都能被isPointInPath(x,y)判断为true，如(50,50);</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line"></span><br><span class="line">ctx.<span class="title function_">rect</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">ctx.<span class="title function_">stroke</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ctx.<span class="title function_">isPointInPath</span>(<span class="number">10</span>, <span class="number">10</span>)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h2 id="sPointInStroke"><a href="#sPointInStroke" class="headerlink" title="sPointInStroke()"></a>sPointInStroke()</h2><p><strong>CanvasRenderingContext2D.isPointInStroke()</strong> 是 Canvas 2D API 用于检测某点是否在路径的描边线上的方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">boolean ctx.<span class="title function_">isPointInStroke</span>(x, y);</span><br><span class="line">boolean ctx.<span class="title function_">isPointInStroke</span>(path, x, y);</span><br></pre></td></tr></table></figure>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/isPointInStroke#参数">参数</a></h3><p>x 检测点的 X 坐标。 y 检测点的 Y 坐标。 path <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Path2D">Path2D</a></p>
<p> 路径。</p>
<h3 id="-66"><a href="#-66" class="headerlink" title=" "></a> </h3><h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/isPointInStroke#返回值">返回值</a></h3><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean">Boolean</a></p>
<p> 一个布尔值，当这个点在路径的描边线上，则返回 true，否则返回 false。 这只是一个使用 <strong>isPointInStroke</strong> 方法的简单的代码片段，用于检测一个点是否在路径的描边线上。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line"></span><br><span class="line">ctx.<span class="title function_">rect</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">ctx.<span class="title function_">stroke</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ctx.<span class="title function_">isPointInStroke</span>(<span class="number">10</span>, <span class="number">10</span>)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h3 id="拖拽小方块"><a href="#拖拽小方块" class="headerlink" title="拖拽小方块"></a>拖拽小方块</h3><p>想要拖拽小方块，我们利用isPointInPath()来判断某一时刻鼠标是否在矩形路径内，如果在路径内，则切换方块为拖拽状态，设定拖拽的样式变化（如光标变小手等等），然后随着鼠标的按下移动通过不断地清除、设定路径、绘制此时刻图像来达成视觉上的拖拽的目的。 <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/22620727/1667053514433-a920e8d2-79c1-4c1c-9396-bab3567982fa.png#clientId=u1356ed4b-ca29-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=565&amp;id=u5029035f&amp;margin=[object Object]&amp;name=image.png&amp;originHeight=565&amp;originWidth=1086&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=90697&amp;status=done&amp;style=none&amp;taskId=u73aa02ed-4ab7-45a8-9be4-0fad61784c9&amp;title=&amp;width=1086" alt="image.png"> 另外有一些必要的细节，我们一定要注意：当鼠标按下拖拽的时候光标位置在矩形内的某个位置，那么在矩形移动后，光标也应该不断保持在矩形的那个位置。 <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/gif/22620727/1667053588638-9a7a04b0-8db4-4606-9660-39c8f5aaab81.gif#clientId=u1356ed4b-ca29-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=248&amp;id=u11194a8a&amp;margin=[object Object]&amp;name=gta8.gif&amp;originHeight=248&amp;originWidth=259&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=31920&amp;status=done&amp;style=none&amp;taskId=u23842d13-e08c-4869-97ff-e7d63963894&amp;title=&amp;width=259" alt="gta8.gif"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;拖拽小方块&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        #canvas &#123;</span><br><span class="line">            cursor: default;</span><br><span class="line">            border: 1px solid black;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;canvas id=&quot;canvas&quot; width=&quot;400&quot; height=&quot;400&quot;&gt;Canvas not supported&lt;/canvas&gt;</span><br><span class="line">&lt;p&gt;拖拽方块并实时重绘&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    &#x27;use strict&#x27;;</span><br><span class="line"></span><br><span class="line">    let canvas = document.getElementById(&#x27;canvas&#x27;),</span><br><span class="line">        context = canvas.getContext(&#x27;2d&#x27;),</span><br><span class="line"></span><br><span class="line">        //初始时的矩形属性</span><br><span class="line">        initX = 10,</span><br><span class="line">        initY = 10,</span><br><span class="line">        initWidth = 100,</span><br><span class="line">        initHeight = 100,</span><br><span class="line"></span><br><span class="line">        isDrag = false,</span><br><span class="line"></span><br><span class="line">        //多边形存储在这个地方</span><br><span class="line">        polygons = &#123;</span><br><span class="line">            fillStyle: &#x27;lightgray&#x27;,</span><br><span class="line">            strokeStyle: &#x27;blue&#x27;,</span><br><span class="line">            loc: &#123;x: 0, y: 0&#125;,</span><br><span class="line">            height: initHeight,</span><br><span class="line">            width: initWidth,</span><br><span class="line">            offsetX: 0,</span><br><span class="line">            offsetY: 0</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //Function……</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 绘制初试状态的矩形</span><br><span class="line">     */</span><br><span class="line">    let drawInitRect = () =&gt; &#123;</span><br><span class="line">        context.fillStyle = polygons.fillStyle;</span><br><span class="line">        context.strokeStyle = polygons.strokeStyle;</span><br><span class="line">        context.rect(initX, initY, initWidth, initHeight);</span><br><span class="line">        polygons.loc.x = initX;</span><br><span class="line">        polygons.loc.y = initY;</span><br><span class="line">        polygons.width = initWidth;</span><br><span class="line">        polygons.height = initHeight;</span><br><span class="line">        context.fill();</span><br><span class="line">        context.stroke();</span><br><span class="line">    &#125;;</span><br><span class="line">    //Event……</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 当鼠标按下式</span><br><span class="line">     * @param ev</span><br><span class="line">     */</span><br><span class="line">    canvas.onmousedown = ev =&gt; &#123;</span><br><span class="line">        isDrag = context.isPointInPath(ev.clientX, ev.clientY);</span><br><span class="line">        polygons.offsetX = ev.clientX - polygons.loc.x;</span><br><span class="line">        polygons.offsetY = ev.clientY - polygons.loc.y;</span><br><span class="line">        polygons.loc.x = ev.clientX;</span><br><span class="line">        polygons.loc.y = ev.clientY;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 鼠标移动时</span><br><span class="line">     * @param ev</span><br><span class="line">     */</span><br><span class="line">    canvas.onmousemove = ev =&gt; &#123;</span><br><span class="line">        if (isDrag) &#123;</span><br><span class="line">            context.beginPath();</span><br><span class="line">            context.clearRect(0, 0, canvas.width, canvas.height);</span><br><span class="line">            context.rect(ev.clientX - polygons.offsetX, ev.clientY - polygons.offsetY, initWidth, initHeight);</span><br><span class="line">            context.fill();</span><br><span class="line">            context.stroke();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            //鼠标经过的时候是否需要变小手</span><br><span class="line">            if (context.isPointInPath(ev.clientX, ev.clientY)) &#123;</span><br><span class="line">                //设置光标状态</span><br><span class="line">                canvas.style.cursor = &#x27;pointer&#x27;;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                canvas.style.cursor = &#x27;default&#x27;;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    canvas.onmouseup = ev =&gt; &#123;</span><br><span class="line">        isDrag = false;</span><br><span class="line">        polygons.loc.x = ev.clientX - polygons.offsetX;</span><br><span class="line">        polygons.loc.y = ev.clientY - polygons.offsetY;</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    //Init……</span><br><span class="line"></span><br><span class="line">    drawInitRect();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://admin741-cl.github.io">admin741</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://admin741-cl.github.io/posts/cdc4.html">https://admin741-cl.github.io/posts/cdc4.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://admin741-cl.github.io" target="_blank">孔乙己的长衫</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a></div><div class="post_share"><div class="social-share" data-image="https://w.wallhaven.cc/full/85/wallhaven-85dgxj.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">不给糖果就捣蛋</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></button></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/3eeb.html" title="Hello World"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Hello World</div></div></a></div><div class="next-post pull-right"><a href="/posts/d238.html" title="源码笔记（更新中）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/p9/wallhaven-p9jdw3.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">源码笔记（更新中）</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/923a.html" title="json-server文档"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/ex/wallhaven-ex9gwo.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-19</div><div class="title">json-server文档</div></div></a></div><div><a href="/posts/f0ec.html" title="vue3笔记（更新中）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/ex/wallhaven-exe1xo.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-19</div><div class="title">vue3笔记（更新中）</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="avatar"/></div><div class="author-info__name">admin741</div><div class="author-info__description">学历不仅是敲门砖 也是我下不来的高台 更是孔乙己脱不下的长衫</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">还没有公告哦，耐心等等吧</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#01-%E8%AE%A4%E8%AF%86canvas"><span class="toc-number">1.</span> <span class="toc-text">01-认识canvas</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">1.2.</span> <span class="toc-text">案例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-1"><span class="toc-number">1.3.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#canvas%E5%85%83%E7%B4%A0"><span class="toc-number">1.4.</span> <span class="toc-text">canvas元素</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-2"><span class="toc-number">1.4.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2%E5%86%85%E5%AE%B9"><span class="toc-number">1.4.2.</span> <span class="toc-text">替换内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9D%9F%E6%A0%87%E7%AD%BE%E4%B8%8D%E5%8F%AF%E7%9C%81"><span class="toc-number">1.4.3.</span> <span class="toc-text">结束标签不可省</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-3"><span class="toc-number">1.5.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93%E4%B8%8A%E4%B8%8B%E6%96%87%EF%BC%88The-rendering-context%EF%BC%89"><span class="toc-number">1.6.</span> <span class="toc-text">渲染上下文（The rendering context）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-4"><span class="toc-number">1.7.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%94%AF%E6%8C%81%E6%80%A7"><span class="toc-number">1.8.</span> <span class="toc-text">检查支持性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E6%A8%A1%E6%9D%BF%E9%AA%A8%E6%9E%B6"><span class="toc-number">1.9.</span> <span class="toc-text">一个模板骨架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-5"><span class="toc-number">1.10.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E4%BE%8B%E5%AD%90"><span class="toc-number">1.11.</span> <span class="toc-text">一个简单例子</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#01-canvas%E7%BB%98%E5%88%B6%E5%9F%BA%E6%9C%AC%E5%9B%BE%E5%BD%A2"><span class="toc-number">2.</span> <span class="toc-text">01-canvas绘制基本图形</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-6"><span class="toc-number">2.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%85%E6%A0%BC"><span class="toc-number">2.2.</span> <span class="toc-text">栅格</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-7"><span class="toc-number">2.3.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%98%E5%88%B6%E7%9F%A9%E5%BD%A2"><span class="toc-number">2.4.</span> <span class="toc-text">绘制矩形</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-8"><span class="toc-number">2.4.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A9%E5%BD%A2%EF%BC%88Rectangular%EF%BC%89%E4%BE%8B%E5%AD%90"><span class="toc-number">2.4.2.</span> <span class="toc-text">矩形（Rectangular）例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-9"><span class="toc-number">2.4.3.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A9%E5%BD%A2"><span class="toc-number">2.4.4.</span> <span class="toc-text">矩形</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-10"><span class="toc-number">2.5.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%98%E5%88%B6%E8%B7%AF%E5%BE%84"><span class="toc-number">2.6.</span> <span class="toc-text">绘制路径</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-11"><span class="toc-number">2.6.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%98%E5%88%B6%E4%B8%80%E4%B8%AA%E4%B8%89%E8%A7%92%E5%BD%A2"><span class="toc-number">2.6.2.</span> <span class="toc-text">绘制一个三角形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E7%AC%94%E8%A7%A6"><span class="toc-number">2.6.3.</span> <span class="toc-text">移动笔触</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-12"><span class="toc-number">2.6.4.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF"><span class="toc-number">2.6.5.</span> <span class="toc-text">线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-13"><span class="toc-number">2.6.6.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%86%E5%BC%A7"><span class="toc-number">2.6.7.</span> <span class="toc-text">圆弧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-14"><span class="toc-number">2.6.8.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8arcTo%E6%96%B9%E6%B3%95"><span class="toc-number">2.6.9.</span> <span class="toc-text">使用arcTo方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-15"><span class="toc-number">2.6.10.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF%E5%8F%8A%E4%B8%89%E6%AC%A1%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF"><span class="toc-number">2.6.11.</span> <span class="toc-text">二次贝塞尔曲线及三次贝塞尔曲线</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-16"><span class="toc-number">2.6.11.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF"><span class="toc-number">2.6.11.2.</span> <span class="toc-text">二次贝塞尔曲线</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-17"><span class="toc-number">2.6.11.3.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E6%AC%A1%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF"><span class="toc-number">2.6.11.4.</span> <span class="toc-text">三次贝塞尔曲线</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-18"><span class="toc-number">2.6.12.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E4%BD%BF%E7%94%A8"><span class="toc-number">2.6.13.</span> <span class="toc-text">组合使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-19"><span class="toc-number">2.7.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Path2D-%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.8.</span> <span class="toc-text">Path2D 对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-20"><span class="toc-number">2.8.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Path2D-%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.8.2.</span> <span class="toc-text">Path2D 示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-21"><span class="toc-number">2.8.3.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-SVG-paths"><span class="toc-number">2.8.4.</span> <span class="toc-text">使用 SVG paths</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#02-%E6%A0%B7%E5%BC%8F%E5%92%8C%E9%A2%9C%E8%89%B2%E6%8E%A7%E5%88%B6"><span class="toc-number">3.</span> <span class="toc-text">02-样式和颜色控制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-22"><span class="toc-number">3.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%89%B2%E5%BD%A9-Colors"><span class="toc-number">3.2.</span> <span class="toc-text">色彩 Colors</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fillStyle%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.2.1.</span> <span class="toc-text">fillStyle示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strokeStyle%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.2.2.</span> <span class="toc-text">strokeStyle示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%8F%E6%98%8E%E5%BA%A6-Transparency"><span class="toc-number">3.3.</span> <span class="toc-text">透明度 Transparency</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-23"><span class="toc-number">3.3.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#globalAlpha%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.3.2.</span> <span class="toc-text">globalAlpha示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-24"><span class="toc-number">3.3.3.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rgba-%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.3.4.</span> <span class="toc-text">rgba()示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-25"><span class="toc-number">3.4.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E5%9E%8B-Line-styles"><span class="toc-number">3.5.</span> <span class="toc-text">线型 Line styles</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-26"><span class="toc-number">3.5.0.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lineWidth-%E5%B1%9E%E6%80%A7%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">3.5.0.2.</span> <span class="toc-text">lineWidth 属性的例子</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-27"><span class="toc-number">3.5.0.3.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lineCap-%E5%B1%9E%E6%80%A7%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">3.5.0.4.</span> <span class="toc-text">lineCap 属性的例子</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-28"><span class="toc-number">3.5.0.5.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lineJoin-%E5%B1%9E%E6%80%A7%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">3.5.0.6.</span> <span class="toc-text">lineJoin 属性的例子</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-29"><span class="toc-number">3.5.0.7.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#miterLimit-%E5%B1%9E%E6%80%A7%E7%9A%84%E6%BC%94%E7%A4%BA%E4%BE%8B%E5%AD%90"><span class="toc-number">3.5.0.8.</span> <span class="toc-text">miterLimit 属性的演示例子</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-30"><span class="toc-number">3.6.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%99%9A%E7%BA%BF"><span class="toc-number">3.7.</span> <span class="toc-text">使用虚线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-31"><span class="toc-number">3.8.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%90%E5%8F%98-Gradients"><span class="toc-number">3.9.</span> <span class="toc-text">渐变 Gradients</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#createLinearGradient-%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">3.9.0.1.</span> <span class="toc-text">createLinearGradient 的例子</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-32"><span class="toc-number">3.9.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#createRadialGradient%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">3.9.2.</span> <span class="toc-text">createRadialGradient的例子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-33"><span class="toc-number">3.10.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E6%A1%88%E6%A0%B7%E5%BC%8F-Patterns"><span class="toc-number">3.11.</span> <span class="toc-text">图案样式 Patterns</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-34"><span class="toc-number">3.11.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#createPattern%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">3.11.2.</span> <span class="toc-text">createPattern的例子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B4%E5%BD%B1-Shadows"><span class="toc-number">3.12.</span> <span class="toc-text">阴影 Shadows</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-35"><span class="toc-number">3.12.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E5%AD%97%E9%98%B4%E5%BD%B1%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">3.12.2.</span> <span class="toc-text">文字阴影的例子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-36"><span class="toc-number">3.13.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Canvas-%E5%A1%AB%E5%85%85%E8%A7%84%E5%88%99"><span class="toc-number">3.14.</span> <span class="toc-text">Canvas 填充规则</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#03-%E7%BB%98%E5%88%B6%E5%9B%BE%E5%83%8F%E5%92%8C%E8%A7%86%E9%A2%91"><span class="toc-number">4.</span> <span class="toc-text">03-绘制图像和视频</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-37"><span class="toc-number">4.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%BE%97%E9%9C%80%E8%A6%81%E7%BB%98%E5%88%B6%E7%9A%84%E5%9B%BE%E7%89%87"><span class="toc-number">4.2.</span> <span class="toc-text">获得需要绘制的图片</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-38"><span class="toc-number">4.2.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%EF%BC%9A%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E7%BA%BF%E5%9B%BE"><span class="toc-number">4.2.2.</span> <span class="toc-text">例子：一个简单的线图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE-Scaling"><span class="toc-number">4.3.</span> <span class="toc-text">缩放 Scaling</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-39"><span class="toc-number">4.3.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%EF%BC%9A%E5%B9%B3%E9%93%BA%E5%9B%BE%E5%83%8F"><span class="toc-number">4.3.2.</span> <span class="toc-text">例子：平铺图像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%87%E7%89%87-Slicing"><span class="toc-number">4.4.</span> <span class="toc-text">切片 Slicing</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-40"><span class="toc-number">4.4.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%EF%BC%9A%E7%9B%B8%E6%A1%86"><span class="toc-number">4.4.2.</span> <span class="toc-text">例子：相框</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A%E7%94%BB%E5%BB%8A-Art-gallery-example"><span class="toc-number">4.5.</span> <span class="toc-text">示例：画廊 Art gallery example</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%9B%BE%E5%83%8F%E7%9A%84%E7%BC%A9%E6%94%BE%E8%A1%8C%E4%B8%BA-Controlling-image-scaling-behavior"><span class="toc-number">4.6.</span> <span class="toc-text">控制图像的缩放行为 Controlling image scaling behavior</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#04-%E7%BB%98%E5%88%B6%E6%96%87%E5%AD%97"><span class="toc-number">5.</span> <span class="toc-text">04-绘制文字</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-41"><span class="toc-number">5.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%98%E5%88%B6%E6%96%87%E6%9C%AC"><span class="toc-number">5.2.</span> <span class="toc-text">绘制文本</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-42"><span class="toc-number">5.2.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E5%A1%AB%E5%85%85%E6%96%87%E6%9C%AC%E7%9A%84%E7%A4%BA%E4%BE%8B"><span class="toc-number">5.2.2.</span> <span class="toc-text">一个填充文本的示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-43"><span class="toc-number">5.2.3.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E6%96%87%E6%9C%AC%E8%BE%B9%E6%A1%86%E7%9A%84%E7%A4%BA%E4%BE%8B"><span class="toc-number">5.2.4.</span> <span class="toc-text">一个文本边框的示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-44"><span class="toc-number">5.3.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E6%A0%B7%E5%BC%8F%E7%9A%84%E6%96%87%E6%9C%AC"><span class="toc-number">5.4.</span> <span class="toc-text">有样式的文本</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-45"><span class="toc-number">5.4.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#textBaseline-%E4%BE%8B%E5%AD%90"><span class="toc-number">5.4.2.</span> <span class="toc-text">textBaseline 例子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%84%E6%B5%8B%E9%87%8F%E6%96%87%E6%9C%AC%E5%AE%BD%E5%BA%A6"><span class="toc-number">5.5.</span> <span class="toc-text">预测量文本宽度</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#05-%E5%8F%98%E5%BD%A2"><span class="toc-number">6.</span> <span class="toc-text">05-变形</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%A0%E4%BD%95%E5%8F%98%E6%8D%A2"><span class="toc-number">6.0.1.</span> <span class="toc-text">几何变换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-46"><span class="toc-number">6.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E7%9A%84%E4%BF%9D%E5%AD%98%E5%92%8C%E6%81%A2%E5%A4%8D-Saving-and-restoring-state"><span class="toc-number">6.2.</span> <span class="toc-text">状态的保存和恢复 Saving and restoring state</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-47"><span class="toc-number">6.2.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#save%E5%92%8Crestore%E7%9A%84%E5%BA%94%E7%94%A8%E4%BE%8B%E5%AD%90"><span class="toc-number">6.2.2.</span> <span class="toc-text">save和restore的应用例子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8-Translating"><span class="toc-number">6.3.</span> <span class="toc-text">移动 Translating</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-48"><span class="toc-number">6.3.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#translate%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">6.3.2.</span> <span class="toc-text">translate的例子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-49"><span class="toc-number">6.4.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%8B%E8%BD%AC-Rotating"><span class="toc-number">6.5.</span> <span class="toc-text">旋转 Rotating</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-50"><span class="toc-number">6.5.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rotate%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">6.5.2.</span> <span class="toc-text">rotate的例子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE-Scaling-1"><span class="toc-number">6.6.</span> <span class="toc-text">缩放 Scaling</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-51"><span class="toc-number">6.6.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scale%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">6.6.2.</span> <span class="toc-text">scale的例子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-52"><span class="toc-number">6.7.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E5%BD%A2-Transforms"><span class="toc-number">6.8.</span> <span class="toc-text">变形 Transforms</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-53"><span class="toc-number">6.8.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#transform-setTransform%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">6.8.2.</span> <span class="toc-text">transform&#x2F;setTransform的例子</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#06-%E5%90%88%E6%88%90"><span class="toc-number">7.</span> <span class="toc-text">06-合成</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-54"><span class="toc-number">7.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#globalCompositeOperation"><span class="toc-number">7.2.</span> <span class="toc-text">globalCompositeOperation</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#07-%E5%89%AA%E8%A3%81"><span class="toc-number">8.</span> <span class="toc-text">07-剪裁</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A3%81%E5%88%87%E8%B7%AF%E5%BE%84"><span class="toc-number">8.1.</span> <span class="toc-text">裁切路径</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-55"><span class="toc-number">8.1.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#clip%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">8.1.2.</span> <span class="toc-text">clip的例子</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#08-%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%8A%A8%E7%94%BB"><span class="toc-number">9.</span> <span class="toc-text">08-基本的动画</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-56"><span class="toc-number">9.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%AD%A5%E9%AA%A4"><span class="toc-number">9.2.</span> <span class="toc-text">动画的基本步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-57"><span class="toc-number">9.3.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E6%8E%A7%E5%8A%A8%E7%94%BB-Controlling-an-animation"><span class="toc-number">9.4.</span> <span class="toc-text">操控动画 Controlling an animation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-58"><span class="toc-number">9.4.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E5%AE%89%E6%8E%92%E7%9A%84%E6%9B%B4%E6%96%B0%E7%94%BB%E5%B8%83Scheduled-updates"><span class="toc-number">9.4.2.</span> <span class="toc-text">有安排的更新画布Scheduled updates</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-59"><span class="toc-number">9.5.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%AA%E9%98%B3%E7%B3%BB%E7%9A%84%E5%8A%A8%E7%94%BB"><span class="toc-number">9.6.</span> <span class="toc-text">太阳系的动画</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB%E6%97%B6%E9%92%9F"><span class="toc-number">9.7.</span> <span class="toc-text">动画时钟</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#09-%E5%83%8F%E7%B4%A0%E6%93%8D%E4%BD%9C"><span class="toc-number">10.</span> <span class="toc-text">09-像素操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-60"><span class="toc-number">10.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ImageData-%E5%AF%B9%E8%B1%A1"><span class="toc-number">10.2.</span> <span class="toc-text">ImageData 对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-ImageData-%E5%AF%B9%E8%B1%A1"><span class="toc-number">10.3.</span> <span class="toc-text">创建一个 ImageData 对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%97%E5%88%B0%E5%9C%BA%E6%99%AF%E5%83%8F%E7%B4%A0%E6%95%B0%E6%8D%AE"><span class="toc-number">10.4.</span> <span class="toc-text">得到场景像素数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-61"><span class="toc-number">10.4.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%9C%E8%89%B2%E9%80%89%E6%8B%A9%E5%99%A8"><span class="toc-number">10.4.2.</span> <span class="toc-text">颜色选择器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-62"><span class="toc-number">10.5.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E5%9C%BA%E6%99%AF%E4%B8%AD%E5%86%99%E5%85%A5%E5%83%8F%E7%B4%A0%E6%95%B0%E6%8D%AE"><span class="toc-number">10.6.</span> <span class="toc-text">在场景中写入像素数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E7%81%B0%E5%BA%A6%E5%92%8C%E5%8F%8D%E7%9B%B8%E9%A2%9C%E8%89%B2"><span class="toc-number">10.6.1.</span> <span class="toc-text">图片灰度和反相颜色</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-63"><span class="toc-number">10.7.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE%E5%92%8C%E5%8F%8D%E9%94%AF%E9%BD%BF"><span class="toc-number">10.8.</span> <span class="toc-text">缩放和反锯齿</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E5%9B%BE%E7%89%87"><span class="toc-number">10.9.</span> <span class="toc-text">保存图片</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E5%9B%BE%E5%BD%A2%E5%85%83%E7%B4%A0%E4%BA%A4%E5%9B%9E"><span class="toc-number">11.</span> <span class="toc-text">10-图形元素交回</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">11.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-64"><span class="toc-number">11.2.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#isPointInPath-%E4%BB%8B%E7%BB%8D"><span class="toc-number">11.3.</span> <span class="toc-text">isPointInPath()介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-65"><span class="toc-number">11.3.1.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">11.3.2.</span> <span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sPointInStroke"><span class="toc-number">11.4.</span> <span class="toc-text">sPointInStroke()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0"><span class="toc-number">11.4.1.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-66"><span class="toc-number">11.4.2.</span> <span class="toc-text"> </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">11.4.3.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%96%E6%8B%BD%E5%B0%8F%E6%96%B9%E5%9D%97"><span class="toc-number">11.4.4.</span> <span class="toc-text">拖拽小方块</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/3eeb.html" title="Hello World">Hello World</a><time datetime="2023-04-14T13:20:30.813Z" title="发表于 2023-04-14 21:20:30">2023-04-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/cdc4.html" title="canvas学习"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/85/wallhaven-85dgxj.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="canvas学习"/></a><div class="content"><a class="title" href="/posts/cdc4.html" title="canvas学习">canvas学习</a><time datetime="2023-01-08T10:59:41.000Z" title="发表于 2023-01-08 18:59:41">2023-01-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/d238.html" title="源码笔记（更新中）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/p9/wallhaven-p9jdw3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="源码笔记（更新中）"/></a><div class="content"><a class="title" href="/posts/d238.html" title="源码笔记（更新中）">源码笔记（更新中）</a><time datetime="2023-01-08T10:59:41.000Z" title="发表于 2023-01-08 18:59:41">2023-01-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/ae65.html" title="为你的夏日带去清凉!"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/m3/wallhaven-m3wr7m.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="为你的夏日带去清凉!"/></a><div class="content"><a class="title" href="/posts/ae65.html" title="为你的夏日带去清凉!">为你的夏日带去清凉!</a><time datetime="2022-10-20T14:06:17.000Z" title="发表于 2022-10-20 22:06:17">2022-10-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/923a.html" title="json-server文档"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/ex/wallhaven-ex9gwo.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="json-server文档"/></a><div class="content"><a class="title" href="/posts/923a.html" title="json-server文档">json-server文档</a><time datetime="2022-09-19T10:47:45.000Z" title="发表于 2022-09-19 18:47:45">2022-09-19</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By admin741</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"></div><div class="aplayer no-destroy" data-id="7308383325" data-server="tencent" data-type="playlist"   data-order="list" data-fixed="true" data-preload="auto" data-autoplay="false" data-mutex="true" ></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><div class="app-refresh" id="app-refresh" style="position: fixed;top: -2.2rem;left: 0;right: 0;z-index: 99999;padding: 0 1rem;font-size: 15px;height: 2.2rem;transition: all 0.3s ease;"><div class="app-refresh-wrap" style=" display: flex;color: #fff;height: 100%;align-items: center;justify-content: center;"><label>✨ 有新文章啦！ 👉</label><a href="javascript:void(0)" onclick="location.reload()"><span style="color: #fff;text-decoration: underline;cursor: pointer;">🍗点击食用🍔</span></a></div></div><script>if ('serviceWorker' in navigator) {
if (navigator.serviceWorker.controller) {
navigator.serviceWorker.addEventListener('controllerchange', function() {
showNotification()
})
}
window.addEventListener('load', function() {
navigator.serviceWorker.register('/sw.js')
})
}
function showNotification() {
if (GLOBAL_CONFIG.Snackbar) {
var snackbarBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
GLOBAL_CONFIG.Snackbar.bgLight :
GLOBAL_CONFIG.Snackbar.bgDark
var snackbarPos = GLOBAL_CONFIG.Snackbar.position
Snackbar.show({
text: '✨ 有新文章啦！ 👉',
backgroundColor: snackbarBg,
duration: 500000,
pos: snackbarPos,
actionText: '🍗点击食用🍔',
actionTextColor: '#fff',
onActionClick: function(e) {
location.reload()
},
})
} else {
var showBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
'#3b70fc' :
'#1f1f1f'
var cssText = `top: 0; background: ${showBg};`
document.getElementById('app-refresh').style.cssText = cssText
}
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'b16a1fa0e63c46a4b8f28abfb06ae3fe';
  var gaud_map_key = 'e2b04289e870b005374ee030148d64fd&s=rsv3';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.982279,28.19409';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><script data-pjax>
    function butterfly_categories_card_injector_config(){
      var parent_div_git = document.getElementById('99be');
      var item_html = '<style>li.categoryBar-list-item{width:32.3%;}.categoryBar-list{max-height: 190px;overflow:auto;}.categoryBar-list::-webkit-scrollbar{width:0!important}@media screen and (max-width: 650px){.categoryBar-list{max-height: 160px;}}</style><div class="recent-post-item" style="height:auto;width:100%;padding:0px;"><div id="categoryBar"><ul class="categoryBar-list"></ul></div></div>';
      console.log('已挂载butterfly_categories_card')
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      }
    if( document.getElementById('99be') && (location.pathname ==='/'|| '/' ==='all')){
    butterfly_categories_card_injector_config()
    }
  </script><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v4.2.2" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://www.jsdelivr.com/" style="margin-inline:5px" data-title="本站使用JsDelivr为静态资源提供CDN加速" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr" alt=""/></a><a class="github-badge" target="_blank" href="https://beian.miit.gov.cn/#/Integrated/index" style="margin-inline:5px" data-title="本站已在湘进行备案" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/豫ICP备-2022000423号-e1d492?style=flat&amp;logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAdCAYAAAC9pNwMAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+nhxg7wAACNlJREFUSInF1mmMVeUdx/Hv2e+5+519mJWBYQZkGxZZxLKJqBXGoLS1iXWrmihotFXaJiTWWlsbl6q1aetWd5u0VkKjNG4YEJSlOCibDLMwM8x679z9nnPP1jcVJUxf+7z6J8+LT37/Z4VvaQhfFS8+sBXbctCDGrVTKlBUH4mxAbI9Hfj0IJLsp6paJ5/tmn20N/D0wKDRMq9F/c3M2U1/V0vDfWMFh+tv/Ig1zYPMabDImPJ52OaXO87W580KggCiiOsJOJ6I3wcNFaaeNKxrt72f2fLGu4FpJ/sDQABRzD22fH7/Yze069vGc6mrDLNIJCDik10sxz2by3VdPM87xzkP9jwPTZFRVI1YUJKH+oy7n3tbvv/P2wW/UQxRWe6w4ZJRptYLHDoCuz8v5cP92XbI762O+h6UVWHnUFbPpU0fEb2A60mMJ7MUi9b/b7UgKhiZMaIxm8YLplLMDPz8hl/EH+rs8TNlUpFf32uyZJGLPDwCiTGUyTWodTN49eUCdz2YwXb9NNcObp1X98WDoufynzMVCEKGn27ayPTWBi5ad8P5iQUkJEnFLjqM9Z+hrVX0vfDe6K2dPRWsW2bwyp9EUifSJB84gdxrkR0eRgv1o/3I4fbbprJ6scqamzVO9pffec1S5ZWY2Nfz5qEy/FqOC2Y3s3j53HMSi18VRjFPwSwg+1RfVbl115vvJrsfej7UGIsYPPGgQ7JXoO+Xx5B3dHEomyJ9x1qiQozkr95h5937aFnVyouPlgJK+Ss7Fxz64OTSxSX+LHYxT2IsRW5kbGI4oHcR0jqoqTjV9se3I7/f8rS/ClS23GxSXhph6L5d9Akm7qqZhHWBQGUJ+CWGFzcg7e7m6D3/ZuW1Ea5YKdA3EojuONi813TqNi+YPYOKUhXDtCeGL26/hakLLiEcdsaHRkRAoLRc4fJrmhnekyF0apgZowWSwwkaa+rw3f8WA1GZZsPP5JEChX8dhZTN6iU6kAcs5s+dHd183SJ0VVKL57pfw6YdRQw23aeWTns47DPTALWlRTR7kMLew6hGgYqUhWXYFFUdPZ6lUBahLA8hVcOftckfi7No7VRAAQqsX1dybfvG1qwriM9mM5mJ4e4jO5Cc01dPqixbr8tWGBQUL4vjGigEEShi+xUmZ2RiR/sJ1pbS8NkgZrKAGw0TsgQsQyFaF/nfYTGprAlMFysbA1pI3mhkR6snhGsaymYGvPyFEb9IdbUE2AzFFTwpRqCtBY0wmdER+hZW4j63gcJj38V+/ErSUZXsYBfjIZHIRW0c2Z8BskCAqN+CbBJBFnyyKjR+Ez57nBxLqpfMUeSISElMBFz6x2Q6OxzWrYjyxWVzEewioU3LCS5vQY6nMUrLwNaxXvoQ59IloFSx54PPAZtQLExVZZDxsVE8J4dn6v4JYatgbSjk0owPw7RGH2ADMo88Z7L20ip8f7gC7fAo0q4+0rt7kEQDvaghVZbiPHUHcyeXcfLjT3jmpR7AYsnSScya3UR8bARVMck7Y/cB75/X6rDf3Fg2dw2jKZm5dXGm1LuAzO5DCo9v6aT0ibco5kzOvLOP+NGTFJtDpPYeZKijk/Rn3QxsfZV7txwhX7ABiZUXBsGvIvguQApNQQva9RMmTvZ2dpVUls+tX/UD7GN/Y8Ws05w6rQF+9vyzg1vZjbvMRJhXiRSU8DpTFFe0QE8S6SfPkOkZoktrB2oAhZWrwljxOPmchiSMYOWNoxNuruFU5vWeXdsojiUon345113dBBQBmTYlTimgdB8nfPo4WjaNFgN9OMEkJ02dnadVt5ki54Esqy+bzKJltVhSPbI3iN2zCyMTeXNCuG7Omm2Zok7PR2+R7jvD8ouruHhmCrB5jVZeYxLdrTP4sr4Vtd9g4MA4qc4c+6cu5NPamfw4P59t2WrA4YdXKkASf7SFivo6PDdEPmf1fRM++zp1bH/0r4I1dD1ODtOWaW4IsvPjL7nqXhloQiSPwjjgMYkMASyGEBkjhISCQwkwzve/18AbT+pk8pVY4UacQi9y+gyZ0eRAw4qHa89LXEx1LXMSPfhDJYRb59BtlLKg2WPT2l6qYl1svtGkrLYckyA1S+t5+2ATm37WCui0LSynsckDNH5zTxAchbQtkx08hDHYiW6NgC0enHBzEZ102UDH8QORdEckjEzZrNWkRydzyx17uGnDXqbUnGZ6dRPjSY91q2TqwjFuvTxLo5Zn5Qo/pumRSFcTLQtybEhGE0fQrDhhJ0VvH2lTnnHPhGtsmWan469apERjI2MH3qN7+7MEfH6ql29CbV7PvsMG32k6yU2XDhEKyZw66eJaRdrXR7CzCcqUNC3zwgymPJRCH4KRRLINimpL14A5Y4GDeOqbsPRVcfuN7Xj44pav/hFfrNT2kr2rsqf2Ibp5pEA14ZIImUyW3t5REkkTXRGQ/DGGhtLginhqCWknQDE5hKf5UFSF9Lj020Q2ul5V1AR2hr+8vuP8Vlc2zMPRxoSjnx7XBC14sDoydahSGq7KdO/HFyrBchxCVfX4fDKp4T7SCQejYODZLrYgIqgKFsNIgQqEYob8mW6yiUyb7Z64LVK/+B85xznnJ3AWzqTzuIX46mr5wLs+UUTyIriBCjRNxguHMJIFDLEEvXEOVRWnSJ0+jCd4CJoGjoedM1CLcXQziW3nMV2TSMBeOx7vWZvPt1r+cMPzE8KunaUkFn0vNrvtqXj34c1W6gzxlEQ6naIoBahtnkMwoFMwIVzSRNguMt53Aj2s4nkSlgPoGqLkICsRNF0gl8rYWuP8+11/w/OOJDEhHPKLCIpOXmi+M9AgP+maiesLifF2T1Rn5ZNj5Lo/Qc/GcPMmhdoqlEgIGzCK4PiCmJKK68p4KfF3qYGuF0qCRUkJTzleUbvQyWRTuE5xYthxQbBs7EISAbkzUFG3VfXXbK2YFi3X/eryfKKnqVBItNjJxDzH8erddC4SqWwcN5WyTtlyO1RP/Lh3eHD76MB40swmiDVJyDLYRhpc5+ub6tse/wWKbvSQEAw1awAAAABJRU5ErkJggg==" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="/js/a.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item swiper_container_card" style="height: auto;width: 100%"><div id="random"><div id="random-banner"><canvas id="peoplecanvas"></canvas></div><a id="random-hover" style="width:100%;height:auto;" href="javascript:toRandomPost()" rel="external nofollow noreferrer" one-link-mark="yes"><i class="fa fa-paper-plane" style="margin-left:10px"></i><div style="margin-left:10px">随便逛逛<i class="fa-solid fa-arrow-right" style="margin-left:10px"></i></div></a></div><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/923a.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/ex/wallhaven-ex9gwo.png" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-09-19</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/923a.html&quot;);" href="javascript:void(0);" alt="">json-server文档</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/923a.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/f0ec.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/ex/wallhaven-exe1xo.jpg" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-10-19</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/f0ec.html&quot;);" href="javascript:void(0);" alt="">vue3笔记（更新中）</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/f0ec.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/d238.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/p9/wallhaven-p9jdw3.jpg" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-01-08</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/d238.html&quot;);" href="javascript:void(0);" alt="">源码笔记（更新中）</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/d238.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/cdc4.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/85/wallhaven-85dgxj.png" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-01-08</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/cdc4.html&quot;);" href="javascript:void(0);" alt="">canvas学习</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/cdc4.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/99be.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/blog-construct/banner.jpg" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-05-08</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/99be.html&quot;);" href="javascript:void(0);" alt="">常见面试题（开胃菜）</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/99be.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/ae65.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://w.wallhaven.cc/full/m3/wallhaven-m3wr7m.png" alt="" onerror="this.src=https://cdn.cbd.int/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-10-20</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/ae65.html&quot;);" href="javascript:void(0);" alt="">为你的夏日带去清凉!</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/ae65.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/js/swiper.min.js"></script><script defer data-pjax src="https://cdn.cbd.int/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/swiper_init.js"></script><script data-pjax src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/gsap/3.9.1/gsap.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/people.min.js"></script><script async src="/anzhiyu/random.js"></script><script async src="/js/ali_font.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('article-sort-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__slideInRight');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body></html>